<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Economy & Politics MCQ Quiz</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and overall look */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px; /* Overall padding for the viewport */
            box-sizing: border-box;
            position: relative;
            overflow-x: hidden; /* Prevent horizontal scrolling */
            overflow-y: auto; /* Allow vertical scrolling */
        }

        /* Background Video Styles */
        #background-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%; /* Keep for robustness */
            min-height: 100%; /* Keep for robustness */
            width: 100vw; /* Explicitly set to viewport width */
            height: 100vh; /* Explicitly set to viewport height */
            object-fit: cover; /* Correct property for video to cover its container */
            z-index: -1; /* Place behind all content */
            filter: brightness(50%); /* Darken the video to improve text readability */
        }

        .quiz-container, .subject-selection-container, .question-count-container, .user-data-container, .user-profile-container, .splash-screen, .home-screen-container, .result-summary-container, .solution-explanation-container, .settings-container, .extra-features-container, .ga-subjects-container, .reasoning-subjects-container, .quantitative-aptitude-subjects-container, .english-language-subjects-container, .computer-knowledge-subjects-container, .general-studies-subjects-container, .current-affairs-subjects-container, .mock-test-zone-subjects-container { /* Added all new subject containers */
            background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent white */
            border-radius: 1rem; /* Rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); /* Stronger shadow for contrast */
            padding: 2.5rem; /* Increased padding */
            max-width: 600px;
            width: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* Space between elements */
            position: relative; /* Ensure content is above the video */
            z-index: 1; /* Place above the video */
            margin-bottom: 20px; /* Add some margin at the bottom for scrolling */
        }

        /* Glassmorphism Auth Container */
        .auth-container {
            background: rgba(0, 0, 0, 0.3); /* Darker semi-transparent background */
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); /* Soft shadow */
            backdrop-filter: blur(10px); /* Glassmorphism blur */
            -webkit-backdrop-filter: blur(10px); /* Safari support */
            border: 1px solid rgba(255, 255, 255, 0.18); /* Subtle white border */
            color: white; /* Default text color for dark theme */
            padding: 2.5rem;
            max-width: 600px;
            width: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
            margin-bottom: 20px;
            overflow: hidden; /* Hide overflow for gradient effect */
        }

        /* Gradient lighting effect for auth-container */
        .auth-container::before {
            content: '';
            position: absolute;
            /* Make it much larger to ensure the subtle edge effect is always visible */
            top: -150%; /* Adjust to keep the center of the gradient far outside */
            left: -150%; /* Adjust to keep the center of the gradient far outside */
            width: 400%; /* Make it significantly larger */
            height: 400%; /* Make it significantly larger */
            background: radial-gradient(circle at 50% 50%, rgba(100, 200, 255, 0.1), transparent 80%); /* Make transparent part larger */
            animation: rotateGradient 15s linear infinite;
            z-index: -1;
            opacity: 0.3;
        }

        @keyframes rotateGradient {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .splash-screen {
            background-color: rgba(76, 81, 191, 0.9); /* Slightly transparent indigo for splash */
            color: white;
            justify-content: center;
            align-items: center;
            height: 100vh; /* Full viewport height */
            width: 100vw; /* Full viewport width */
            position: fixed; /* Cover the entire screen */
            top: 0;
            left: 0;
            z-index: 1000; /* Ensure it's on top */
            gap: 2rem;
            opacity: 1; /* Start visible */
            transition: opacity 0.5s ease-out; /* Smooth fade out */
        }
        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none; /* Disable interactions when hidden */
        }
        .splash-screen img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid white;
            animation: scaleIn 0.8s ease-out forwards; /* Apply scale-in animation */
        }
        .splash-screen .tagline {
            font-size: 2.2rem;
            font-weight: 700;
            margin-top: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            opacity: 0; /* Start hidden for animation */
            transform: translateY(20px); /* Start below for slide-up */
            animation: fadeInUp 0.8s ease-out 0.3s forwards; /* Apply fade-in-up animation with delay */
        }

        /* Keyframe Animations */
        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Home Screen Styles */
        .home-screen-container {
            position: relative; /* Added for absolute positioning of profile icon */
        }
        .home-screen-container h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1.5rem;
        }
        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .quick-access-card {
            background-color: #edf2f7;
            padding: 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            color: #2d3748;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 2px solid #cbd5e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }
        .quick-access-card:hover {
            background-color: #d1d5db;
            border-color: #a0aec0;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .quick-access-card .icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .home-screen-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            justify-content: center; /* Center buttons when wrapped */
        }
        .home-screen-buttons .next-button {
            flex: 1;
            min-width: 180px; /* Ensure buttons don't get too small */
        }


        .question-text {
            font-size: 1.5rem; /* Larger font size */
            font-weight: 600;
            color: #1a202c; /* Darker text */
            margin-bottom: 1.5rem;
        }
        .option-button, .subject-button, .start-practice-button, .view-activity-button, .back-button, .view-profile-button, .settings-button, .extra-feature-button { /* Removed auth-button, toggle-auth-button from here */
            display: block;
            width: 100%;
            padding: 0.8rem 1.2rem;
            margin-bottom: 0.8rem; /* Space between buttons */
            background-color: #e2e8f0; /* Light gray button */
            color: #2d3748; /* Darker text */
            border: 2px solid #cbd5e0; /* Light border */
            border-radius: 0.75rem; /* Rounded corners */
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s ease-in-out;
            text-align: left; /* Align text to left */
        }
        .option-button:hover:not(:disabled), .subject-button:hover, .start-practice-button:hover:not(:disabled), .view-activity-button:hover, .back-button:hover, .view-profile-button:hover, .settings-button:hover, .extra-feature-button:hover { /* Removed auth-button, toggle-auth-button from here */
            background-color: #d1d5db; /* Darker on hover */
            border-color: #a0aec0;
        }
        .option-button:disabled, .start-practice-button:disabled { /* Removed auth-button from here */
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-button.correct {
            background-color: #a7f3d0; /* Green for correct */
            border-color: #34d399;
            color: #065f46;
        }
        .option-button.incorrect {
            background-color: #fecaca; /* Red for incorrect */
            border-color: #ef4444;
            color: #991b1b;
        }
        .feedback-message {
            margin-top: 1rem;
            font-size: 1.2rem;
            font-weight: 500;
            color: #4a5568;
        }
        .correct-answer-display {
            margin-top: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #059669; /* Green for correct answer text */
        }
        .timer-display {
            font-size: 2rem; /* Larger timer */
            font-weight: 700;
            color: #ef4444; /* Red for timer */
            margin-bottom: 1rem;
        }
        .quiz-navigation-buttons {
            display: flex;
            gap: 1rem; /* Space between buttons */
            margin-top: 1.5rem;
            justify-content: center; /* Center the buttons */
        }
        .next-button, .show-result-button {
            flex: 1; /* Make buttons take equal width */
            background-color: #4c51bf; /* Indigo button */
            color: white;
            padding: 0.9rem 1.8rem;
            border-radius: 0.75rem;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: none;
        }
        .next-button:hover:not(:disabled), .show-result-button:hover:not(:disabled) {
            background-color: #4338ca; /* Darker indigo on hover */
        }
        .next-button:disabled, .show-result-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .quiz-finished-message {
            font-size: 1.8rem;
            font-weight: 700;
            color: #059669;
            margin-top: 2rem;
        }
        .quiz-summary {
            text-align: left;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }
        .quiz-summary p {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }
        .quiz-summary p span {
            font-weight: 600;
            color: #1a202c;
        }
        .question-count-input, .profile-input, .settings-input { /* Removed auth-input from here */
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #cbd5e0;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.9rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
        }
        .user-info-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 1rem;
        }
        .user-info-container p {
            font-size: 0.9rem;
            color: #4a5568;
        }
        .user-info-container button {
            background-color: #ef4444;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s ease-in-out;
        }
        .user-info-container button:hover {
            background-color: #dc2626;
        }
        .auth-input-group {
            margin-bottom: 1rem;
        }
        .auth-input-group label {
            display: block;
            text-align: left;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: white; /* Changed for dark theme */
        }

        /* Glassmorphism Auth Inputs */
        .auth-input {
            width: 100%;
            padding: 0.8rem;
            background-color: rgba(255, 255, 255, 0.1); /* Semi-transparent white */
            border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle light border */
            border-radius: 0.75rem;
            font-size: 1.1rem;
            color: white; /* White text */
            text-align: left;
            transition: all 0.2s ease-in-out;
        }
        .auth-input::placeholder {
            color: rgba(255, 255, 255, 0.7); /* Lighter placeholder */
        }
        .auth-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
        }
        .auth-input-phone-group {
            display: flex;
            gap: 0.5rem;
        }
        .auth-input-phone-group select {
            flex-shrink: 0;
            width: 80px; /* Fixed width for country code dropdown */
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            color: white;
            padding: 0.8rem;
            font-size: 1.1rem;
        }
        .auth-input-phone-group input {
            flex-grow: 1;
        }


        .auth-button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .auth-button-group .auth-button {
            flex: 1;
            text-align: center;
            margin-bottom: 0; /* Override default margin */
        }

        /* Redesigned Auth Buttons */
        .auth-button {
            display: block;
            width: 100%;
            padding: 0.8rem 1.2rem;
            margin-bottom: 0.8rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s ease-in-out;
            text-align: center;
            border: none; /* Remove default border */
        }
        .auth-button:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .auth-button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Specific button styles */
        #email-signup-button { /* "Create an account" button */
            background-color: white;
            color: #1a202c; /* Dark text on white button */
            font-weight: bold;
        }
        #email-login-button {
            background-color: #4c51bf; /* Indigo */
            color: white;
        }
        #forgot-password-button {
            background-color: #ed8936; /* Orange */
            color: white;
        }
        #google-login-button, #apple-login-button, #anonymous-login-button {
            background-color: rgba(255, 255, 255, 0.1); /* Transparent white */
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        #google-login-button:hover, #apple-login-button:hover, #anonymous-login-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        #auth-main-title, #auth-intro-text {
            color: white; /* Ensure these are white */
        }

        /* Auth Toggle Buttons (Sign up / Sign in) */
        .auth-toggle-buttons {
            display: flex;
            gap: 0.5rem; /* Reduced gap */
            background-color: rgba(255, 255, 255, 0.05); /* Very subtle transparent background */
            border-radius: 0.75rem;
            padding: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .auth-toggle-buttons .toggle-auth-button {
            flex: 1;
            padding: 0.7rem 1.2rem;
            border-radius: 0.6rem; /* Slightly smaller radius than container */
            background-color: transparent;
            color: rgba(255, 255, 255, 0.7); /* Lighter white for inactive */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: none;
        }
        .auth-toggle-buttons .toggle-auth-button.active {
            background-color: rgba(255, 255, 255, 0.15); /* More opaque white when active */
            color: white; /* Solid white for active */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .auth-toggle-buttons .toggle-auth-button:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Terms of Service Note */
        .terms-note {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 1.5rem;
            line-height: 1.4;
        }
        .terms-note a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: underline;
        }
        .terms-note a:hover {
            color: white;
        }

        /* Styles for user data display */
        .user-data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        .user-data-table th, .user-data-table td {
            border: 1px solid #e2e8f0;
            padding: 0.8rem;
            text-align: left;
            font-size: 0.95rem;
        }
        .user-data-table th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }
        .user-data-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .user-data-table tbody tr:hover {
            background-color: #edf2f7;
        }
        .streak-display {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4c51bf;
            margin-bottom: 1rem;
        }
        .profile-info {
            margin-top: 1.5rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center profile content */
        }
        .profile-info img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
            border: 3px solid #4c51bf; /* Border around profile pic */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .profile-info p {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }
        .profile-info p span {
            font-weight: 600;
            color: #1a202c;
        }
        .profile-field-group { /* New style for input groups in profile */
            width: 100%;
            margin-bottom: 1rem;
            text-align: left;
        }
        .profile-field-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
        }
        .profile-message { /* New style for profile messages */
            font-size: 1rem;
            margin-top: 1rem;
            font-weight: 500;
        }
        .profile-intro-text { /* New style for the intro text */
            text-align: left;
            margin-bottom: 1.5rem;
            color: white; /* Changed for dark theme */
        }
        .profile-intro-text h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: white; /* Changed for dark theme */
            margin-bottom: 0.8rem;
        }
        .profile-intro-text p {
            font-size: 1rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.8); /* Lighter white for body text */
        }
        .profile-intro-text ul {
            list-style: disc;
            margin-left: 20px;
            margin-top: 10px;
        }
        .profile-intro-text li {
            margin-bottom: 5px;
        }
        
        /* Result Summary Page Styles */
        .result-summary-container h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1.5rem;
        }
        .result-summary-container p {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: #2d3748;
        }
        .result-summary-container p span {
            font-weight: 600;
            color: #1a202c;
        }
        .result-summary-container .score-percentage {
            font-size: 3rem;
            font-weight: 800;
            color: #4c51bf;
            margin: 1.5rem 0;
        }
        .result-summary-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        .result-summary-buttons .next-button {
            background-color: #4c51bf;
            color: white;
        }
        .result-summary-buttons .next-button.retry {
            background-color: #38a169; /* Green for retry */
        }
        .result-summary-buttons .next-button.share {
            background-color: #ed8936; /* Orange for share */
        }
        .result-summary-buttons .next-button:hover {
            opacity: 0.9;
        }

        /* Solution/Explanation Page Styles */
        .solution-explanation-container h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1.5rem;
        }
        .solution-item {
            background-color: #edf2f7;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            text-align: left;
            border: 2px solid #cbd5e0;
        }
        .solution-item .solution-q-text {
            font-weight: 600;
            color: #1a202c;
        }
        .solution-item .solution-a-text {
            font-weight: 600;
            color: #059669;
        }
        .solution-item .solution-exp-text {
            color: #4a5568;
        }
        .solution-item .solution-learn-more {
            color: #4c51bf;
            text-decoration: underline;
            margin-top: 0.5rem;
            display: inline-block;
        }
        .solution-item .solution-learn-more:hover {
            color: #4338ca;
        }
        .solutions-list-container {
            max-height: 400px; /* Limit height for scrollability */
            overflow-y: auto; /* Enable vertical scrolling */
            padding-right: 10px; /* Space for scrollbar */
            margin-bottom: 1.5rem;
        }

        /* Profile Page Specific Styles */
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
        }
        .profile-stat-card {
            background-color: #edf2f7;
            padding: 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            color: #2d3748;
            border: 2px solid #cbd5e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }
        .profile-stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4c51bf;
        }
        .weak-areas-list {
            list-style: disc;
            margin-left: 20px;
            text-align: left;
            color: #ef4444;
            font-weight: 500;
        }
        .weak-areas-section {
            margin-top: 1.5rem;
            text-align: left;
        }
        .weak-areas-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.8rem;
        }
        .profile-buttons-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        /* Settings Page Specific Styles */
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .settings-option:last-child {
            border-bottom: none;
        }
        .settings-option label {
            font-size: 1.1rem;
            color: #2d3748;
            font-weight: 500;
        }
        .settings-option select, .settings-option input[type="checkbox"] {
            margin-left: 1rem;
        }
        .settings-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .settings-option .settings-button {
            background-color: #4c51bf;
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s ease-in-out;
        }
        .settings-option .settings-button:hover {
            background-color: #4338ca;
        }
        /* Extra Features Page Specific Styles */
        .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            background-color: #edf2f7;
            border-radius: 0.75rem;
            border: 2px solid #cbd5e0;
            font-size: 1.1rem;
            color: #2d3748;
            font-weight: 500;
            text-align: left;
        }
        .feature-item .icon {
            font-size: 1.8rem;
            color: #4c51bf;
        }
    </style>
</head>
<body>
    <!-- Background Video -->
    <video autoplay muted loop id="background-video">
        <source src="bg.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Splash Screen -->
    <div class="splash-screen" id="splash-screen">
        <img src="image.png" alt="SSC KNOCKOUT Logo">
        <div class="tagline">Practice Smart, Crack SSC</div>
    </div>

    <!-- Authentication Container (Login/Signup) -->
    <div class="auth-container" id="auth-container" style="display: none;">
        <h1 class="text-3xl font-bold mb-6" id="auth-main-title">Welcome to the Quiz App!</h1>
        <p class="text-lg mb-4" id="auth-intro-text">Please log in or sign up to continue.</p>

        <div class="auth-toggle-buttons">
            <button id="show-login-button" class="toggle-auth-button active">Sign In</button>
            <button id="show-signup-button" class="toggle-auth-button">Sign Up</button>
        </div>

        <!-- Login Form Section -->
        <div id="login-form-section" class="auth-form-section active">
            <div class="auth-input-group">
                <label for="login-email-input">Email:</label>
                <input type="email" id="login-email-input" class="auth-input" placeholder="your@example.com">
            </div>
            <div class="auth-input-group">
                <label for="login-password-input">Password:</label>
                <input type="password" id="login-password-input" class="auth-input" placeholder="********">
            </div>
            <p id="auth-error-message" class="error-message" style="display: none;"></p>

            <button id="email-login-button" class="auth-button bg-blue-500 hover:bg-blue-600 text-white">Sign In with Email</button>
            <button id="forgot-password-button" class="auth-button bg-yellow-600 hover:bg-yellow-700 text-white mt-4">Forgot Password?</button>
            
            <div class="my-6 text-gray-500">OR</div>

            <button id="google-login-button" class="auth-button">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" class="w-5 h-5 inline-block mr-2">
                Sign In with Google
            </button>
            <button id="anonymous-login-button" class="auth-button">
                <span class="text-xl mr-2">👤</span>
                Sign In Anonymously
            </button>
            <button id="apple-login-button" class="auth-button">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/apple.svg" alt="Apple logo" class="w-5 h-5 inline-block mr-2">
                Sign In with Apple
            </button>
        </div>

        <!-- Sign Up Form Section -->
        <div id="signup-form-section" class="auth-form-section">
            <div class="profile-intro-text">
                <p>Let’s get started with setting up your profile.</p>
                <p>Please fill in the following details:</p>
            </div>

            <div class="auth-input-group">
                <label for="signup-first-name-input">👤 First Name:</label>
                <input type="text" id="signup-first-name-input" class="auth-input" placeholder="Your First Name">
            </div>
            <div class="auth-input-group">
                <label for="signup-last-name-input">👤 Last Name:</label>
                <input type="text" id="signup-last-name-input" class="auth-input" placeholder="Your Last Name">
            </div>
            
            <div class="auth-input-group">
                <label for="signup-email-input">📧 Email Address:</label>
                <input type="email" id="signup-email-input" class="auth-input" placeholder="your@example.com">
            </div>

            <div class="auth-input-group">
                <label for="signup-phone-input">📱 Phone Number:</label>
                <div class="auth-input-phone-group">
                    <select id="signup-country-code-input">
                        <option value="+1">+1 (USA/Canada)</option>
                        <option value="+91" selected>+91 (India)</option>
                        <option value="+44">+44 (UK)</option>
                        <option value="+61">+61 (Australia)</option>
                        <option value="+49">+49 (Germany)</option>
                        <option value="+33">+33 (France)</option>
                        <!-- Add more country codes as needed -->
                    </select>
                    <input type="tel" id="signup-phone-input" class="auth-input" placeholder="e.g., 9876543210">
                </div>
            </div>

            <div class="auth-input-group">
                <label for="signup-password-input">🔒 Password:</label>
                <input type="password" id="signup-password-input" class="auth-input" placeholder="********">
            </div>

            <div class="auth-input-group">
                <label for="signup-confirm-password-input">🔒 Confirm Password:</label>
                <input type="password" id="signup-confirm-password-input" class="auth-input" placeholder="********">
            </div>

            <div class="auth-input-group">
                <label for="signup-age-input">🎂 Age (Optional):</label>
                <input type="number" id="signup-age-input" class="auth-input" placeholder="e.g., 30" min="1">
            </div>

            <div class="auth-input-group">
                <label for="signup-gender-input">🚻 Gender (Optional):</label>
                <select id="signup-gender-input" class="auth-input">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                </select>
            </div>

            <div class="auth-input-group">
                <label for="signup-about-you-input">🗣️ About You (Optional):</label>
                <textarea id="signup-about-you-input" class="auth-input" rows="3" placeholder="Tell us a little about yourself..."></textarea>
            </div>

            <p id="auth-error-message-signup" class="error-message" style="display: none;"></p>

            <button id="email-signup-button" class="auth-button">Create an account</button>
            
            <div class="my-6 text-gray-500">OR</div>

            <button id="google-signup-button" class="auth-button">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" class="w-5 h-5 inline-block mr-2">
                Sign Up with Google
            </button>
            <button id="apple-signup-button" class="auth-button">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/apple.svg" alt="Apple logo" class="w-5 h-5 inline-block mr-2">
                Sign Up with Apple
            </button>

            <p class="terms-note">
                By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
            </p>
        </div>
    </div>

    <!-- Home Screen -->
    <div class="home-screen-container" id="home-screen-container" style="display: none;">
        <!-- New Profile Icon in corner -->
        <div id="home-profile-icon" class="absolute top-4 right-4 w-12 h-12 rounded-full overflow-hidden cursor-pointer border-2 border-indigo-500 shadow-md">
            <img id="home-profile-photo" src="https://placehold.co/48x48/cccccc/333333?text=👤" alt="Profile" class="w-full h-full object-cover">
        </div>

        <div class="user-info-container">
            <p>Logged in as: <span id="home-user-display-name"></span></p>
        </div>
        <h1>Hello, <span id="welcome-user-name">User</span> 👋 Ready to Practice?</h1>
        
        <h2 class="text-2xl font-bold text-gray-800 mb-4">📌 Quick Access: Choose a Subject to Practice</h2>
        <p class="text-lg text-gray-700 mb-4">Tap any subject card below to begin practicing questions. Each category includes topic-wise MCQs, detailed solutions, and timed quizzes.</p>

        <h3 class="text-xl font-bold text-gray-700 mt-6 mb-3 text-left">🔹 Core Sections</h3>
        <div class="quick-access-grid">
            <div class="quick-access-card" id="card-general-awareness">
                <span class="icon">📘</span>
                General Awareness
                <span class="text-sm text-gray-500">Static GK, Current Affairs, Polity, History, Geography, Science & Economy</span>
            </div>
            <div class="quick-access-card" id="card-reasoning">
                <span class="icon">🧠</span>
                Reasoning (General Intelligence)
                <span class="text-sm text-gray-500">Analogy, Series, Puzzles, Coding-Decoding, Blood Relations & more</span>
            </div>
            <div class="quick-access-card" id="card-quantitative-aptitude">
                <span class="icon">📐</span>
                Quantitative Aptitude (Maths)
                <span class="text-sm text-gray-500">Arithmetic, Algebra, Geometry, Mensuration, Trigonometry & DI</span>
            </div>
            <div class="quick-access-card" id="card-english-language">
                <span class="icon">📚</span>
                English Language
                <span class="text-sm text-gray-500">Vocabulary, Grammar, Reading Comprehension, Cloze Test & Spot the Error</span>
            </div>
        </div>

        <h3 class="text-xl font-bold text-gray-700 mt-6 mb-3 text-left">🔸 Optional / Add-on Sections</h3>
        <div class="quick-access-grid">
            <div class="quick-access-card" id="card-computer-knowledge">
                <span class="icon">🖥️</span>
                Computer Knowledge
                <span class="text-sm text-gray-500">Basics of Computer, Internet, MS Office, Abbreviations</span>
            </div>
            <div class="quick-access-card" id="card-general-studies">
                <span class="icon">💼</span>
                General Studies (JE / Tier 2)
                <span class="text-sm text-gray-500">Engineering Subjects, Advanced Economics & Polity</span>
            </div>
            <div class="quick-access-card" id="card-current-affairs">
                <span class="icon">📅</span>
                Current Affairs
                <span class="text-sm text-gray-500">Daily Quizzes, Budget, Govt Schemes, Monthly PDFs</span>
            </div>
            <div class="quick-access-card" id="card-mock-test-zone">
                <span class="icon">🎯</span>
                Mock Test Zone
                <span class="text-sm text-gray-500">Full-length SSC CGL/CHSL/MTS mocks, Sectional & Tier-wise tests</span>
            </div>
        </div>

        <div class="home-screen-buttons">
            <button id="extra-features-button" class="next-button bg-green-600 hover:bg-green-700">Extra Features</button>
        </div>
    </div>

    <!-- Subject Selection Container (for individual GA subjects) -->
    <div class="subject-selection-container" id="subject-selection-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Choose Your Quiz Subject</h1>
        <button id="economy-button" class="subject-button">Indian Economy</button>
        <button id="politics-button" class="subject-button">Indian Politics</button>
        <button id="history-button" class="subject-button">Indian History</button>
        <button id="geography-button" class="subject-button">Geography</button>
        <button id="view-activity-button" class="view-activity-button bg-indigo-600 hover:bg-indigo-700 text-white mt-4">View My Activity</button>
        <button id="view-profile-button" class="view-profile-button bg-purple-600 hover:bg-purple-700 text-white mt-2">View My Profile</button>
    </div>

    <!-- General Awareness Sub-subjects Container -->
    <div class="ga-subjects-container" id="ga-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-ga"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">General Awareness: Select Topic</h1>
        <button id="ga-static-gk-button" class="subject-button">Static GK</button>
        <button id="ga-current-affairs-button" class="subject-button">Current Affairs</button>
        <button id="ga-polity-button" class="subject-button">Polity</button>
        <button id="ga-history-button" class="subject-button">History</button>
        <button id="ga-geography-button" class="subject-button">Geography</button>
        <button id="ga-science-button" class="subject-button">Science</button>
        <button id="ga-economy-button" class="subject-button">Economy</button>
        <button id="back-to-home-from-ga-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Reasoning Sub-subjects Container -->
    <div class="reasoning-subjects-container" id="reasoning-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-reasoning"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Reasoning: Select Topic</h1>
        <button id="reasoning-analogy-button" class="subject-button">Analogy</button>
        <button id="reasoning-series-button" class="subject-button">Series</button>
        <button id="reasoning-puzzles-button" class="subject-button">Puzzles</button>
        <button id="reasoning-coding-decoding-button" class="subject-button">Coding-Decoding</button>
        <button id="reasoning-blood-relations-button" class="subject-button">Blood Relations</button>
        <button id="back-to-home-from-reasoning-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Quantitative Aptitude Sub-subjects Container -->
    <div class="quantitative-aptitude-subjects-container" id="quantitative-aptitude-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-quant"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Quantitative Aptitude: Select Topic</h1>
        <button id="quant-arithmetic-button" class="subject-button">Arithmetic</button>
        <button id="quant-algebra-button" class="subject-button">Algebra</button>
        <button id="quant-geometry-button" class="subject-button">Geometry</button>
        <button id="quant-mensuration-button" class="subject-button">Mensuration</button>
        <button id="quant-trigonometry-button" class="subject-button">Trigonometry</button>
        <button id="quant-di-button" class="subject-button">Data Interpretation</button>
        <button id="back-to-home-from-quant-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- English Language Sub-subjects Container -->
    <div class="english-language-subjects-container" id="english-language-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-english"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">English Language: Select Topic</h1>
        <button id="english-vocabulary-button" class="subject-button">Vocabulary</button>
        <button id="english-grammar-button" class="subject-button">Grammar</button>
        <button id="english-reading-comprehension-button" class="subject-button">Reading Comprehension</button>
        <button id="english-cloze-test-button" class="subject-button">Cloze Test</button>
        <button id="english-spot-error-button" class="subject-button">Spot the Error</button>
        <button id="back-to-home-from-english-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Computer Knowledge Sub-subjects Container -->
    <div class="computer-knowledge-subjects-container" id="computer-knowledge-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-computer"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Computer Knowledge: Select Topic</h1>
        <button id="computer-basics-button" class="subject-button">Basics of Computer</button>
        <button id="computer-internet-button" class="subject-button">Internet</button>
        <button id="computer-ms-office-button" class="subject-button">MS Office</button>
        <button id="computer-abbreviations-button" class="subject-button">Abbreviations</button>
        <button id="back-to-home-from-computer-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- General Studies Sub-subjects Container -->
    <div class="general-studies-subjects-container" id="general-studies-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-general-studies"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">General Studies: Select Topic</h1>
        <button id="gs-engineering-button" class="subject-button">Engineering Subjects</button>
        <button id="gs-advanced-economy-button" class="subject-button">Advanced Economics</button>
        <button id="gs-advanced-polity-button" class="subject-button">Advanced Polity</button>
        <button id="back-to-home-from-general-studies-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Current Affairs Sub-subjects Container -->
    <div class="current-affairs-subjects-container" id="current-affairs-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-current-affairs"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Current Affairs: Select Topic</h1>
        <button id="ca-daily-quizzes-button" class="subject-button">Daily Quizzes</button>
        <button id="ca-budget-button" class="subject-button">Budget</button>
        <button id="ca-govt-schemes-button" class="subject-button">Government Schemes</button>
        <button id="ca-monthly-pdfs-button" class="subject-button">Monthly PDFs</button>
        <button id="back-to-home-from-current-affairs-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Mock Test Zone Sub-subjects Container -->
    <div class="mock-test-zone-subjects-container" id="mock-test-zone-subjects-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-mock-test-zone"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Mock Test Zone: Select Test Type</h1>
        <button id="mtz-full-length-mocks-button" class="subject-button">Full Length Mocks</button>
        <button id="mtz-sectional-tests-button" class="subject-button">Sectional Tests</button>
        <button id="mtz-tier-wise-tests-button" class="subject-button">Tier-wise Tests</button>
        <button id="back-to-home-from-mock-test-zone-subjects" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <!-- Question Count Selection Container -->
    <div class="question-count-container" id="question-count-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-2"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Practice <span id="selected-subject-title"></span></h1>
        <p class="text-lg text-gray-700 mb-4">Total questions available: <span id="total-available-questions" class="font-bold"></span></p>
        <label for="num-questions" class="block text-gray-700 text-lg font-medium mb-2">How many questions do you want to practice?</label>
        <input type="number" id="num-questions" class="question-count-input" min="1" value="5">
        <p id="question-count-error" class="error-message" style="display: none;"></p>
        <button id="start-practice-button" class="next-button">Start Practice</button>
        <button id="back-to-subject-selection-from-question-count" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Subject Selection</button>
    </div>

    <!-- Quiz Container (Practice/Test Module Page) -->
    <div class="quiz-container" id="quiz-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-3"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-4">
            <span id="quiz-subject-title"></span>
        </h1>

        <div class="flex justify-center items-center gap-2 mb-4">
            <span class="text-2xl font-bold text-gray-700">⏱ Timer:</span>
            <span id="timer-display" class="timer-display">20</span>
            <span class="text-lg text-gray-600">seconds/question</span>
        </div>

        <div id="question-display" class="question-text"></div>

        <div id="options-container" class="flex flex-col gap-3">
            <!-- Options will be dynamically inserted here -->
        </div>

        <div id="feedback-area" class="feedback-message"></div>
        <div id="correct-answer-area" class="correct-answer-area"></div>

        <div class="quiz-navigation-buttons">
            <button id="back-to-question-count-from-quiz" class="back-button bg-blue-500 hover:bg-blue-600 text-white">Back to Question Count</button>
            <button id="next-button" class="next-button" disabled>Next Question</button>
            <button id="show-result-button" class="show-result-button">Show Result</button>
        </div>
    </div>

    <!-- Result Summary Page -->
    <div class="result-summary-container" id="result-summary-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-result-span"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Quiz Results</h1>
        <p>Subject: <span id="result-subject"></span></p>
        <p>Total Questions: <span id="result-total-questions"></span></p>
        <p>Correct Answers: <span id="result-correct-count" class="text-green-600"></span></p>
        <p>Incorrect Answers: <span id="result-incorrect-count" class="text-red-600"></span></p>
        <p>Time Taken: <span id="result-time-taken"></span> seconds</p>
        <p class="score-percentage" id="result-score-percentage">0%</p>

        <div class="result-summary-buttons">
            <button id="view-solutions-button" class="next-button">View Solutions</button>
            <button id="retry-test-button" class="next-button retry">Retry Test</button>
            <button id="share-score-button" class="next-button share">Share Score</button>
            <button id="back-to-question-count-from-result" class="next-button bg-blue-500 hover:bg-blue-600 text-white">Back to Question Count</button>
        </div>
    </div>

    <!-- Solution/Explanation Page -->
    <div class="solution-explanation-container" id="solution-explanation-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-solution"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Solutions & Explanations</h1>
        <div id="solutions-list" class="solutions-list-container">
            <!-- Solutions will be dynamically inserted here -->
        </div>
        <button id="back-to-results-button" class="next-button bg-blue-500 hover:bg-blue-600 text-white mt-2">Back to Results</button>
    </div>


    <!-- User Data Container (Activity & Results) -->
    <div class="user-data-container" id="user-data-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-4"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Your Activity & Results</h1>
        <p class="streak-display">Current Daily Streak: <span id="current-streak-display">0</span> 🔥</p>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Past Quiz Attempts</h2>
        <div id="past-attempts-list">
            <p class="text-gray-600">Loading your past quiz attempts...</p>
        </div>
        <button id="back-to-quiz-selection" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Quiz Selection</button>
    </div>

    <!-- User Profile Container -->
    <div class="user-profile-container" id="user-profile-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-profile"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">My Profile</h1>
        <div class="profile-info">
            <img id="profile-photo" src="https://placehold.co/120x120/cccccc/333333?text=No+Photo" alt="Profile Photo">
            
            <div class="profile-field-group">
                <label for="edit-display-name-input">Full Name:</label>
                <input type="text" id="edit-display-name-input" class="profile-input" placeholder="Your Full Name">
            </div>
            
            <div class="profile-field-group">
                <label for="edit-email-input">Email Address:</label>
                <input type="email" id="edit-email-input" class="profile-input" placeholder="your@example.com">
            </div>

            <div class="profile-field-group">
                <label for="edit-mobile-input">Mobile Number:</label>
                <input type="tel" id="edit-mobile-input" class="profile-input" placeholder="e.g., +91 9876543210">
            </div>

            <div class="profile-input-group">
                <label for="edit-age-input">Age:</label>
                <input type="number" id="edit-age-input" class="profile-input" placeholder="e.g., 30" min="1">
            </div>

            <div class="profile-input-group">
                <label for="edit-gender-input">Gender:</label>
                <select id="edit-gender-input" class="profile-input">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                </select>
            </div>

            <div class="profile-input-group">
                <label for="edit-about-you-input">About You (Optional):</label>
                <textarea id="edit-about-you-input" class="profile-input" rows="3" placeholder="Tell us a little about yourself..."></textarea>
            </div>

            <p>User ID: <span id="profile-user-id" class="font-bold">N/A</span></p>
            <p id="profile-message" class="profile-message" style="display: none;"></p>
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-4">Progress Stats</h2>
        <div class="profile-stats-grid">
            <div class="profile-stat-card">
                <span class="stat-value" id="profile-tests-attempted">0</span>
                <span>Tests Attempted</span>
            </div>
            <div class="profile-stat-card">
                <span class="stat-value" id="profile-average-score">0%</span>
                <span>Average Score</span>
            </div>
        </div>
        <div class="weak-areas-section">
            <h2 class="text-xl font-bold text-gray-800 mb-2">Weak Areas:</h2>
            <ul id="profile-weak-areas" class="weak-areas-list">
                <li>No weak areas identified yet! Keep practicing!</li>
            </ul>
        </div>


        <div class="profile-buttons-group">
            <button id="save-profile-button" class="next-button bg-green-500 hover:bg-green-600">Save Profile</button>
            <button id="go-to-settings-button" class="next-button bg-gray-500 hover:bg-gray-600">Settings</button>
            <button id="back-to-subject-selection-from-profile" class="back-button bg-blue-500 hover:bg-blue-600 text-white">Back to Quiz Selection</button>
            <button class="logout-button-class next-button bg-red-500 hover:bg-red-600">Logout</button>
        </div>
    </div>

    <!-- Settings Page -->
    <div class="settings-container" id="settings-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-settings"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Settings</h1>

        <div class="settings-option">
            <label for="change-password-button">Change Password</label>
            <button id="change-password-button" class="settings-button">Change</button>
        </div>

        <div class="settings-option">
            <label for="notifications-toggle">Notifications</label>
            <input type="checkbox" id="notifications-toggle" class="settings-input" checked>
        </div>

        <div class="settings-option">
            <label for="language-select">Language</label>
            <select id="language-select" class="settings-input">
                <option value="English">English</option>
                <option value="Hindi">Hindi</option>
            </select>
        </div>

        <div class="settings-option">
            <label for="dark-mode-toggle">Dark Mode</label>
            <input type="checkbox" id="dark-mode-toggle" class="settings-input">
        </div>

        <div class="settings-option">
            <label for="help-feedback-button">Help / Feedback</label>
            <button id="help-feedback-button" class="settings-button">Go</button>
        </div>

        <button id="back-to-profile-from-settings" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Profile</button>
    </div>

    <!-- Extra Features Page -->
    <div class="extra-features-container" id="extra-features-container" style="display: none;">
        <div class="user-info-container">
            <p>Logged in as: <span id="user-id-display-extra-features"></span></p>
            <button class="logout-button-class">Logout</button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Extra Features (Future Scope)</h1>

        <div class="feature-item">
            <span class="icon">🔔</span>
            Daily Quiz Notification
        </div>
        <div class="feature-item">
            <span class="icon">📌</span>
            Bookmark Difficult Questions
        </div>
        <div class="feature-item">
            <span class="icon">💬</span>
            Doubt Discussion Forum
        </div>
        <div class="feature-item">
            <span class="icon">🏆</span>
            Leaderboard (Compare with peers)
        </div>
        <div class="feature-item">
            <span class="icon">📴</span>
            Offline Mode
        </div>

        <button id="back-to-home-from-extra-features" class="back-button bg-blue-500 hover:bg-blue-600 text-white mt-6">Back to Home</button>
    </div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signOut, 
            onAuthStateChanged, 
            signInWithCustomToken,
            GoogleAuthProvider, 
            signInWithPopup,    
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            sendPasswordResetEmail,
            updateProfile 
        } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            push, 
            set, 
            get, 
            update, 
            query, 
            orderByChild, 
            limitToLast, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";


        // Firebase Configuration (using __firebase_config if available, otherwise fallback to provided)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyChjZ5N-1FEnejaahfpFPxIq2R7nQuTuDc",
            authDomain: "test-2378c.firebaseapp.com",
            databaseURL: "https://test-2378c-default-rtdb.asia-southeast1.firebasedatabase.app", // Corrected URL!
            projectId: "test-2378c",
            storageBucket: "test-2378c.appspot.com", // Corrected storageBucket!
            messagingSenderId: "440618434249",
            appId: "1:440618434249:web:f5c3d49edc53545a459718",
            measurementId: "G-NB1917M42Y"
        };

        // Initialize Firebase variables at a higher scope but assign within DOMContentLoaded
        let app;
        let auth;
        let db;

        let userId = null; 
        let currentUserEmail = null; 

        let allQuestionsFromDB = {}; 
        let quizQuestionsAttempted = []; // New: To store questions for solutions page

        let questions = []; 
        let currentQuestionIndex = 0;
        let timerInterval;
        const timePerQuestion = 20; 
        let questionStartTime; 
        let selectedSubjectName = ''; 
        let lastQuizSetupScreen = ''; // Global to store the ID of the screen that led to question count

        // Quiz statistics
        let correctAnswersCount = 0;
        let incorrectAnswersCount = 0;
        let questionsAttempted = 0;
        let totalTimeTaken = 0; 

        // Get references to HTML elements
        const splashScreen = document.getElementById('splash-screen'); 
        const authContainer = document.getElementById('auth-container'); 
        const authMainTitle = document.getElementById('auth-main-title');
        const authIntroText = document.getElementById('auth-intro-text');

        const showLoginButton = document.getElementById('show-login-button');
        const showSignupButton = document.getElementById('show-signup-button');
        const loginFormSection = document.getElementById('login-form-section');
        const signupFormSection = document.getElementById('signup-form-section');

        const googleLoginButton = document.getElementById('google-login-button'); 
        const anonymousLoginButton = document.getElementById('anonymous-login-button'); 
        const appleLoginButton = document.getElementById('apple-login-button'); // New Apple login button
        
        const loginEmailInput = document.getElementById('login-email-input'); 
        const loginPasswordInput = document.getElementById('login-password-input'); 
        const emailLoginButton = document.getElementById('email-login-button'); 
        const forgotPasswordButton = document.getElementById('forgot-password-button'); 
        const authErrorMessage = document.getElementById('auth-error-message'); 

        const signupFirstNameInput = document.getElementById('signup-first-name-input'); // New
        const signupLastNameInput = document.getElementById('signup-last-name-input'); // New
        const signupCountryCodeInput = document.getElementById('signup-country-code-input'); // New
        const signupPhoneInput = document.getElementById('signup-phone-input'); // New
        const signupEmailInput = document.getElementById('signup-email-input'); 
        const signupMobileInput = document.getElementById('signup-mobile-input'); // This will be removed or repurposed
        const signupPasswordInput = document.getElementById('signup-password-input'); 
        const signupConfirmPasswordInput = document.getElementById('signup-confirm-password-input'); 
        const signupAgeInput = document.getElementById('signup-age-input'); 
        const signupGenderInput = document.getElementById('signup-gender-input'); 
        const signupAboutYouInput = document.getElementById('signup-about-you-input'); 
        const emailSignupButton = document.getElementById('email-signup-button'); 
        const googleSignupButton = document.getElementById('google-signup-button'); // New
        const appleSignupButton = document.getElementById('apple-signup-button'); // New
        const authErrorMessageSignup = document.getElementById('auth-error-message-signup'); // New for signup errors

        const homeScreenContainer = document.getElementById('home-screen-container'); 
        const welcomeUserName = document.getElementById('welcome-user-name'); 
        const cardGeneralAwareness = document.getElementById('card-general-awareness'); 
        const cardReasoning = document.getElementById('card-reasoning'); 
        const cardQuantitativeAptitude = document.getElementById('card-quantitative-aptitude'); 
        const cardEnglishLanguage = document.getElementById('card-english-language'); 
        const cardComputerKnowledge = document.getElementById('card-computer-knowledge'); // New
        const cardGeneralStudies = document.getElementById('card-general-studies'); // New
        const cardCurrentAffairs = document.getElementById('card-current-affairs'); // New
        const cardMockTestZone = document.getElementById('card-mock-test-zone'); // New
        const extraFeaturesButton = document.getElementById('extra-features-button'); 

        // New elements for home screen profile icon
        const homeProfileIcon = document.getElementById('home-profile-icon');
        const homeProfilePhoto = document.getElementById('home-profile-photo');
        const homeUserDisplayName = document.getElementById('home-user-display-name'); 


        const userIdDisplay = document.getElementById('user-id-display');
        const userIdDisplay2 = document.getElementById('user-id-display-2');
        const userIdDisplay3 = document.getElementById('user-id-display-3');
        const userIdDisplay4 = document.getElementById('user-id-display-4'); 
        const userIdDisplayProfile = document.getElementById('user-id-display-profile'); 
        const userIdDisplayResultSpan = document.getElementById('user-id-display-result-span'); // Corrected usage
        const userIdDisplaySolution = document.getElementById('user-id-display-solution'); 
        const userIdDisplaySettings = document.getElementById('user-id-display-settings'); 
        const userIdDisplayExtraFeatures = document.getElementById('user-id-display-extra-features'); 
        const userIdDisplayGa = document.getElementById('user-id-display-ga'); // For GA sub-subjects container
        const userIdDisplayReasoning = document.getElementById('user-id-display-reasoning'); // New
        const userIdDisplayQuant = document.getElementById('user-id-display-quant'); // New
        const userIdDisplayEnglish = document.getElementById('user-id-display-english'); // New
        const userIdDisplayComputer = document.getElementById('user-id-display-computer'); // New
        const userIdDisplayGeneralStudies = document.getElementById('user-id-display-general-studies'); // New
        const userIdDisplayCurrentAffairs = document.getElementById('user-id-display-current-affairs'); // New
        const userIdDisplayMockTestZone = document.getElementById('user-id-display-mock-test-zone'); // New
        let logoutButtons; 

        const subjectSelectionContainer = document.getElementById('subject-selection-container');
        const gaSubjectsContainer = document.getElementById('ga-subjects-container'); // New GA subjects container
        const reasoningSubjectsContainer = document.getElementById('reasoning-subjects-container'); // New
        const quantitativeAptitudeSubjectsContainer = document.getElementById('quantitative-aptitude-subjects-container'); // New
        const englishLanguageSubjectsContainer = document.getElementById('english-language-subjects-container'); // New
        const computerKnowledgeSubjectsContainer = document.getElementById('computer-knowledge-subjects-container'); // New
        const generalStudiesSubjectsContainer = document.getElementById('general-studies-subjects-container'); // New
        const currentAffairsSubjectsContainer = document.getElementById('current-affairs-subjects-container'); // New
        const mockTestZoneSubjectsContainer = document.getElementById('mock-test-zone-subjects-container'); // New
        const questionCountContainer = document.getElementById('question-count-container');
        const quizContainer = document.getElementById('quiz-container');
        const userDataContainer = document.getElementById('user-data-container'); 
        const userProfileContainer = document.getElementById('user-profile-container'); 
        const resultSummaryContainer = document.getElementById('result-summary-container'); 
        const solutionExplanationContainer = document.getElementById('solution-explanation-container'); 
        const settingsContainer = document.getElementById('settings-container'); 
        const extraFeaturesContainer = document.getElementById('extra-features-container'); 

        const economyButton = document.getElementById('economy-button');
        const politicsButton = document.getElementById('politics-button');
        const historyButton = document.getElementById('history-button');
        const geographyButton = document.getElementById('geography-button');
        const viewActivityButton = document.getElementById('view-activity-button'); 
        const viewProfileButton = document.getElementById('view-profile-button'); 
        const backToQuizSelectionButton = document.getElementById('back-to-quiz-selection'); 
        const backToSubjectSelectionFromProfileButton = document.getElementById('back-to-subject-selection-from-profile'); 

        // New GA sub-subject buttons
        const gaStaticGkButton = document.getElementById('ga-static-gk-button');
        const gaCurrentAffairsButton = document.getElementById('ga-current-affairs-button');
        const gaPolityButton = document.getElementById('ga-polity-button');
        const gaHistoryButton = document.getElementById('ga-history-button');
        const gaGeographyButton = document.getElementById('ga-geography-button');
        const gaScienceButton = document.getElementById('ga-science-button');
        const gaEconomyButton = document.getElementById('ga-economy-button');
        const backToHomeFromGaSubjectsButton = document.getElementById('back-to-home-from-ga-subjects');

        // New Reasoning sub-subject buttons
        const reasoningAnalogyButton = document.getElementById('reasoning-analogy-button');
        const reasoningSeriesButton = document.getElementById('reasoning-series-button');
        const reasoningPuzzlesButton = document.getElementById('reasoning-puzzles-button');
        const reasoningCodingDecodingButton = document.getElementById('reasoning-coding-decoding-button');
        const reasoningBloodRelationsButton = document.getElementById('reasoning-blood-relations-button');
        const backToHomeFromReasoningSubjectsButton = document.getElementById('back-to-home-from-reasoning-subjects');

        // New Quantitative Aptitude sub-subject buttons
        const quantArithmeticButton = document.getElementById('quant-arithmetic-button');
        const quantAlgebraButton = document.getElementById('quant-algebra-button');
        const quantGeometryButton = document.getElementById('quant-geometry-button');
        const quantMensurationButton = document.getElementById('quant-mensuration-button');
        const quantTrigonometryButton = document.getElementById('quant-trigonometry-button');
        const quantDiButton = document.getElementById('quant-di-button');
        const backToHomeFromQuantSubjectsButton = document.getElementById('back-to-home-from-quant-subjects');

        // New English Language sub-subject buttons
        const englishVocabularyButton = document.getElementById('english-vocabulary-button');
        const englishGrammarButton = document.getElementById('english-grammar-button'); 
        const englishReadingComprehensionButton = document.getElementById('english-reading-comprehension-button');
        const englishClozeTestButton = document.getElementById('english-cloze-test-button');
        const englishSpotErrorButton = document.getElementById('english-spot-error-button');
        const backToHomeFromEnglishSubjectsButton = document.getElementById('back-to-home-from-english-subjects');

        // New Computer Knowledge sub-subject buttons
        const computerBasicsButton = document.getElementById('computer-basics-button');
        const computerInternetButton = document.getElementById('computer-internet-button');
        const computerMsOfficeButton = document.getElementById('computer-ms-office-button');
        const computerAbbreviationsButton = document.getElementById('computer-abbreviations-button');
        const backToHomeFromComputerSubjectsButton = document.getElementById('back-to-home-from-computer-subjects');

        // New General Studies sub-subject buttons
        const gsEngineeringButton = document.getElementById('gs-engineering-button');
        const gsAdvancedEconomyButton = document.getElementById('gs-advanced-economy-button');
        const gsAdvancedPolityButton = document.getElementById('gs-advanced-polity-button');
        const backToHomeFromGeneralStudiesSubjectsButton = document.getElementById('back-to-home-from-general-studies-subjects');

        // New Current Affairs Sub-subject buttons
        const caDailyQuizzesButton = document.getElementById('ca-daily-quizzes-button');
        const caBudgetButton = document.getElementById('ca-budget-button');
        const caGovtSchemesButton = document.getElementById('ca-govt-schemes-button');
        const caMonthlyPdfsButton = document.getElementById('ca-monthly-pdfs-button');
        const backToHomeFromCurrentAffairsSubjectsButton = document.getElementById('back-to-home-from-current-affairs-subjects');

        // New Mock Test Zone Sub-subject buttons
        const mtzFullLengthMocksButton = document.getElementById('mtz-full-length-mocks-button');
        const mtzSectionalTestsButton = document.getElementById('mtz-sectional-tests-button');
        const mtzTierWiseTestsButton = document.getElementById('mtz-tier-wise-tests-button');
        const backToHomeFromMockTestZoneSubjectsButton = document.getElementById('back-to-home-from-mock-test-zone-subjects');


        const selectedSubjectTitle = document.getElementById('selected-subject-title');
        const totalAvailableQuestionsSpan = document.getElementById('total-available-questions');
        const numQuestionsInput = document.getElementById('num-questions');
        const questionCountError = document.getElementById('question-count-error');
        const startPracticeButton = document.getElementById('start-practice-button');
        const backToSubjectSelectionFromQuestionCountButton = document.getElementById('back-to-subject-selection-from-question-count'); // New

        const quizSubjectTitle = document.getElementById('quiz-subject-title');
        const questionDisplay = document.getElementById('question-display');
        const optionsContainer = document.getElementById('options-container');
        const timerDisplay = document.getElementById('timer-display');
        const feedbackArea = document.getElementById('feedback-area');
        const correctAnswerArea = document.getElementById('correct-answer-area');
        const nextButton = document.getElementById('next-button');
        const showResultButton = document.getElementById('show-result-button');
        const backToQuestionCountFromQuizButton = document.getElementById('back-to-question-count-from-quiz'); // New
        let restartQuizButton; 

        const currentStreakDisplay = document.getElementById('current-streak-display'); 
        const pastAttemptsList = document.getElementById('past-attempts-list'); 

        const profilePhoto = document.getElementById('profile-photo'); 
        const profileUserId = document.getElementById('profile-user-id');

        // Elements for editable profile (on My Profile page)
        const editDisplayNameInput = document.getElementById('edit-display-name-input');
        const editEmailInput = document.getElementById('edit-email-input');
        const editMobileInput = document.getElementById('edit-mobile-input'); 
        const editAgeInput = document.getElementById('edit-age-input'); 
        const editGenderInput = document.getElementById('edit-gender-input'); 
        const editAboutYouInput = document.getElementById('edit-about-you-input'); 
        const saveProfileButton = document.getElementById('save-profile-button');
        const goToSettingsButton = document.getElementById('go-to-settings-button'); 
        const profileMessage = document.getElementById('profile-message');

        // Elements for Result Summary Page
        const resultSubject = document.getElementById('result-subject');
        const resultTotalQuestions = document.getElementById('result-total-questions');
        const resultCorrectCount = document.getElementById('result-correct-count');
        const resultIncorrectCount = document.getElementById('result-incorrect-count');
        const resultTimeTaken = document.getElementById('result-time-taken');
        const resultScorePercentage = document.getElementById('result-score-percentage');
        const viewSolutionsButton = document.getElementById('view-solutions-button');
        const retryTestButton = document.getElementById('retry-test-button');
        const shareScoreButton = document.getElementById('share-score-button');
        const backToQuestionCountFromResultButton = document.getElementById('back-to-question-count-from-result'); // New

        // Elements for Solution/Explanation Page
        const solutionsList = document.getElementById('solutions-list'); 
        const backToResultsButton = document.getElementById('back-to-results-button'); 

        // New elements for Profile Page Stats
        const profileTestsAttempted = document.getElementById('profile-tests-attempted');
        const profileAverageScore = document.getElementById('profile-average-score');
        const profileWeakAreas = document.getElementById('profile-weak-areas');

        // New elements for Settings Page
        const changePasswordButton = document.getElementById('change-password-button');
        const notificationsToggle = document.getElementById('notifications-toggle');
        const languageSelect = document.getElementById('language-select');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const helpFeedbackButton = document.getElementById('help-feedback-button');
        const backToProfileFromSettingsButton = document.getElementById('back-to-profile-from-settings');

        // New elements for Extra Features Page
        const backToHomeFromExtraFeaturesButton = document.getElementById('back-to-home-from-extra-features');


        /**
         * Toggles the visibility between the login and signup forms.
         * @param {string} formToShow - 'login' or 'signup'
         */
        function toggleAuthForms(formToShow) {
            if (formToShow === 'login') {
                loginFormSection.classList.add('active');
                signupFormSection.classList.remove('active');
                showLoginButton.classList.add('active');
                showSignupButton.classList.remove('active');
                authMainTitle.textContent = "Welcome Back!";
                authIntroText.textContent = "Please sign in to continue.";
                authErrorMessageSignup.style.display = 'none'; // Clear signup errors
            } else { // formToShow === 'signup'
                loginFormSection.classList.remove('active');
                signupFormSection.classList.add('active');
                showLoginButton.classList.remove('active');
                showSignupButton.classList.add('active');
                authMainTitle.textContent = "Join the Quiz App!";
                authIntroText.textContent = "Create your account to get started.";
                authErrorMessage.style.display = 'none'; // Clear login errors
            }
            authErrorMessage.style.display = 'none'; // Clear errors when switching
        }


        /**
         * Fisher-Yates (Knuth) shuffle algorithm for array randomization.
         * @param {Array} array - The array to shuffle.
         * @returns {Array} The shuffled array.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
            }

        /**
         * Formats a timestamp (milliseconds since epoch) into a readable date string.
         * @param {number} timestamp - Timestamp in milliseconds.
         * @returns {string} Formatted date string.
         */
        function formatTimestamp(timestamp) {
            if (!timestamp) {
                return 'N/A';
            }
            const date = new Date(timestamp);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        /**
         * Checks if a date is yesterday compared to today.
         * @param {Date} someDate - The date to check.
         * @param {Date} today - The current date.
         * @returns {boolean} True if someDate is yesterday, false otherwise.
         */
        function isYesterday(someDate, today) {
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            return someDate.getFullYear() === yesterday.getFullYear() &&
                   someDate.getMonth() === yesterday.getMonth() &&
                   someDate.getDate() === yesterday.getDate();
        }

        /**
         * Fetches all quiz questions from the Realtime Database and stores them.
         */
        async function fetchAllQuestionsFromDB() {
            console.log("Fetching all questions from Realtime Database...");
            const questionsRef = ref(db, 'questions'); // Assuming questions are stored under a 'questions' node
            try {
                const snapshot = await get(questionsRef);
                if (snapshot.exists()) {
                    const questionsData = snapshot.val();
                    allQuestionsFromDB = {}; // Reset
                    // Group questions by subject
                    Object.keys(questionsData).forEach(key => {
                        const question = questionsData[key];
                        // Ensure question.subject exists and is a string
                        if (question.subject && typeof question.subject === 'string') {
                            if (!allQuestionsFromDB[question.subject]) {
                                allQuestionsFromDB[question.subject] = [];
                            }
                            allQuestionsFromDB[question.subject].push(question);
                        } else {
                            console.warn(`Question with key ${key} has no subject or invalid subject type. Skipping.`, question);
                        }
                    });
                    console.log("Questions fetched and grouped:", allQuestionsFromDB);
                } else {
                    console.warn("No questions found in Realtime Database under '/questions'. Please ensure data is present and correctly structured.");
                    // Optionally, display a message to the user or load default questions
                }
            } catch (error) {
                console.error("Error fetching questions from Realtime Database:", error);
                // This error often means a permission issue. Ensure your Realtime Database rules allow reads for the 'questions' node.
                // Example rule: { "rules": { "questions": { ".read": true, ".write": false } } }
                // Also, check if the 'questions' node actually exists in your Firebase Realtime Database.
            }
        }

        /**
         * Updates the UI based on the current authentication state.
         * Fetches user data (like streak) if logged in.
         * @param {firebase.User} user - The authenticated Firebase user object, or null if logged out.
         */
        async function updateUI(user) {
            console.log("updateUI called with user:", user ? user.uid : "null");
            if (user) {
                userId = user.uid;
                // Determine user's display name for UI
                let userDisplayName = user.email || 'Anonymous User';
                if (user.displayName) {
                    userDisplayName = user.displayName;
                } else if (user.email) {
                    userDisplayName = user.email; // Fallback to email if display name not available
                } else if (user.isAnonymous) {
                    userDisplayName = 'Anonymous User';
                }

                // Update all user display elements
                userIdDisplay.textContent = userDisplayName;
                userIdDisplay2.textContent = userDisplayName;
                userIdDisplay3.textContent = userDisplayName;
                userIdDisplay4.textContent = userDisplayName; 
                userIdDisplayProfile.textContent = userDisplayName; 
                userIdDisplayResultSpan.textContent = userDisplayName; // Corrected usage
                userIdDisplaySolution.textContent = userDisplayName; 
                userIdDisplaySettings.textContent = userDisplayName; 
                userIdDisplayExtraFeatures.textContent = userDisplayName; 
                userIdDisplayGa.textContent = userDisplayName; // For GA sub-subjects container
                userIdDisplayReasoning.textContent = userDisplayName; // New
                userIdDisplayQuant.textContent = userDisplayName; // New
                userIdDisplayEnglish.textContent = userDisplayName; // New
                userIdDisplayComputer.textContent = userDisplayName; // New
                userIdDisplayGeneralStudies.textContent = userDisplayName; // New
                userIdDisplayCurrentAffairs.textContent = userDisplayName; // New
                userIdDisplayMockTestZone.textContent = userDisplayName; // New
                homeUserDisplayName.textContent = userDisplayName; // Update for home screen user info
                welcomeUserName.textContent = userDisplayName.split(' ')[0]; // Show first name or full if no space

                // Update home screen profile photo
                homeProfilePhoto.src = user.photoURL || "https://placehold.co/48x48/cccccc/333333?text=👤";


                // Hide splash screen and auth container, show home screen
                splashScreen.classList.add('hidden'); // Add hidden class for fade out
                // Use a timeout to fully hide and remove from layout after transition
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    authContainer.style.display = 'none'; 
                    homeScreenContainer.style.display = 'flex'; // Show home screen
                    subjectSelectionContainer.style.display = 'none';
                    gaSubjectsContainer.style.display = 'none'; // Ensure GA subjects container is hidden
                    reasoningSubjectsContainer.style.display = 'none'; // New
                    quantitativeAptitudeSubjectsContainer.style.display = 'none'; // New
                    englishLanguageSubjectsContainer.style.display = 'none'; // New
                    computerKnowledgeSubjectsContainer.style.display = 'none'; // New
                    generalStudiesSubjectsContainer.style.display = 'none'; // New
                    currentAffairsSubjectsContainer.style.display = 'none'; // New
                    mockTestZoneSubjectsContainer.style.display = 'none'; // New
                    questionCountContainer.style.display = 'none';
                    quizContainer.style.display = 'none';
                    userDataContainer.style.display = 'none'; 
                    userProfileContainer.style.display = 'none'; 
                    resultSummaryContainer.style.display = 'none'; 
                    solutionExplanationContainer.style.display = 'none'; 
                    settingsContainer.style.display = 'none'; 
                    extraFeaturesContainer.style.display = 'none'; 
                    authErrorMessage.style.display = 'none'; 
                    authErrorMessageSignup.style.display = 'none'; // Also hide signup error
                }, 500); // Match this to the transition duration in CSS

                // Fetch and display user streak from Realtime Database
                if (userId) {
                    const userRef = ref(db, `users/${userId}`);
                    try {
                        const snapshot = await get(userRef);
                        let userData = {};
                        if (snapshot.exists()) {
                            userData = snapshot.val();
                            currentStreakDisplay.textContent = userData.currentStreak || 0;
                            console.log("Fetched user streak:", userData.currentStreak);
                        } else {
                            // If user data doesn't exist, initialize with defaults
                            userData.currentStreak = 0;
                            userData.lastQuizDate = null;
                            currentStreakDisplay.textContent = 0;
                            console.log("Initialized new user data in Realtime DB with default streak.");
                        }

                        // Update user profile data in Realtime DB (display name, email, photoURL)
                        // This ensures basic profile info is stored for all login types
                        const profileUpdates = {};
                        if (user.displayName && userData.displayName !== user.displayName) {
                            profileUpdates.displayName = user.displayName;
                        }
                        if (user.email && userData.email !== user.email) {
                            profileUpdates.email = user.email;
                        }
                        // Add photoURL if available (e.g., from Google login)
                        if (user.photoURL && userData.photoURL !== user.photoURL) {
                            profileUpdates.photoURL = user.photoURL;
                        }
                        
                        if (Object.keys(profileUpdates).length > 0) {
                            await update(userRef, profileUpdates);
                            console.log("User profile data updated in Realtime DB:", profileUpdates);
                        }

                    } catch (error) {
                        console.error("Error fetching/setting user streak or profile from Realtime DB:", error);
                        currentStreakDisplay.textContent = "Error";
                    }
                }

            } else {
                userId = null;
                currentUserEmail = null;
                console.log("User logged out, showing login screen.");
                splashScreen.classList.add('hidden'); // Ensure splash screen fades out
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    authContainer.style.display = 'flex'; 
                    homeScreenContainer.style.display = 'none'; 
                    subjectSelectionContainer.style.display = 'none';
                    gaSubjectsContainer.style.display = 'none'; // Ensure GA subjects container is hidden
                    reasoningSubjectsContainer.style.display = 'none'; // New
                    quantitativeAptitudeSubjectsContainer.style.display = 'none'; // New
                    englishLanguageSubjectsContainer.style.display = 'none'; // New
                    computerKnowledgeSubjectsContainer.style.display = 'none'; // New
                    generalStudiesSubjectsContainer.style.display = 'none'; // New
                    currentAffairsSubjectsContainer.style.display = 'none'; // New
                    mockTestZoneSubjectsContainer.style.display = 'none'; // New
                    questionCountContainer.style.display = 'none';
                    quizContainer.style.display = 'none';
                    userDataContainer.style.display = 'none'; 
                    userProfileContainer.style.display = 'none'; 
                    resultSummaryContainer.style.display = 'none'; 
                    solutionExplanationContainer.style.display = 'none'; 
                    settingsContainer.style.display = 'none'; 
                    extraFeaturesContainer.style.display = 'none'; 
                    // Clear input fields on logout
                    loginEmailInput.value = '';
                    loginPasswordInput.value = '';
                    signupFirstNameInput.value = ''; // Clear new fields
                    signupLastNameInput.value = ''; // Clear new fields
                    signupPhoneInput.value = ''; // Clear new fields
                    signupEmailInput.value = '';
                    signupMobileInput.value = '';
                    signupPasswordInput.value = '';
                    signupConfirmPasswordInput.value = '';
                    signupAgeInput.value = '';
                    signupGenderInput.value = '';
                    signupAboutYouInput.value = '';
                    authErrorMessage.textContent = '';
                    authErrorMessage.style.display = 'none';
                    authErrorMessageSignup.textContent = ''; // Clear signup error
                    authErrorMessageSignup.style.display = 'none'; // Hide signup error
                    toggleAuthForms('login'); // Default to login form on logout
                }, 500); // Match this to the transition duration in CSS
            }
        }

        /**
         * Displays an authentication error message.
         * @param {string} message - The error message to display.
         * @param {HTMLElement} errorElement - The specific error message element to update.
         */
        function showAuthError(message, errorElement = authErrorMessage) {
            // Specific message for unauthorized-domain error
            if (message.includes("auth/unauthorized-domain")) {
                message += " Please add your app's domain (e.g., localhost or your Vercel URL) to Firebase Console > Authentication > Settings > Authorized domains.";
            }
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            errorElement.style.color = '#ef4444'; 
            console.error("Auth Error:", message); 
        }

        /**
         * Handles anonymous login.
         */
        async function loginAnonymously() {
            console.log("Attempting anonymous login...");
            try {
                await signInAnonymously(auth);
                console.log("Signed in anonymously successfully.");
            } catch (error) {
                console.error("Error signing in anonymously:", error);
                showAuthError(`Anonymous login failed: ${error.message}`);
            }
        }

        /**
         * Handles Google login.
         */
        async function signInWithGoogle() {
            console.log("Attempting Google login...");
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
                console.log("Signed in with Google successfully.");
            } catch (error) {
                console.error("Error signing in with Google:", error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showAuthError("Google login popup closed by user.");
                } else if (error.code === 'auth/cancelled-popup-request') {
                    showAuthError("Google login popup already open or request cancelled.");
                } else if (error.code === 'auth/unauthorized-domain') {
                    showAuthError(`Google login failed: ${error.message}`);
                }
                else {
                    showAuthError(`Google login failed: ${error.message}`);
                }
            }
        }

        /**
         * Handles Apple login (placeholder).
         */
        async function signInWithApple() {
            console.log("Apple login functionality coming soon!");
            showAuthError("Apple login is not yet implemented.", authErrorMessage);
        }

        /**
         * Handles email/password sign up.
         */
        async function signUpWithEmailPassword() {
            const firstName = signupFirstNameInput.value.trim();
            const lastName = signupLastNameInput.value.trim();
            const email = signupEmailInput.value.trim();
            const countryCode = signupCountryCodeInput.value;
            const phoneNumber = signupPhoneInput.value.trim();
            const password = signupPasswordInput.value;
            const confirmPassword = signupConfirmPasswordInput.value;
            const age = signupAgeInput.value.trim();
            const gender = signupGenderInput.value.trim();
            const aboutYou = signupAboutYouInput.value.trim();

            console.log(`Attempting email signup for: ${email}`);
            if (!firstName || !lastName || !email || !password) {
                showAuthError("Please enter First Name, Last Name, Email, and Password to register.", authErrorMessageSignup);
                return;
            }
            if (password.length < 6) {
                showAuthError("Password should be at least 6 characters.", authErrorMessageSignup);
                return;
            }
            if (password !== confirmPassword) {
                showAuthError("Passwords do not match.", authErrorMessageSignup);
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log("Signed up with email/password successfully. User:", user.uid);

                const fullName = `${firstName} ${lastName}`;
                // Update Firebase Auth profile with display name
                await updateProfile(user, { displayName: fullName });

                // Save additional profile data to Realtime Database
                const userRef = ref(db, `users/${user.uid}`);
                await set(userRef, {
                    displayName: fullName,
                    firstName: firstName, // Store first name separately
                    lastName: lastName,   // Store last name separately
                    email: email,
                    phoneNumber: phoneNumber ? `${countryCode}${phoneNumber}` : null, // Store combined phone number
                    age: age || null,
                    gender: gender || null,
                    aboutYou: aboutYou || null,
                    createdAt: serverTimestamp(),
                    currentStreak: 0,
                    lastQuizDate: null
                });
                console.log("Additional user profile data saved to Realtime Database.");

            } catch (error) {
                console.error("Error signing up with email/password:", error);
                showAuthError(`Registration failed: ${error.message}`, authErrorMessageSignup);
            }
        }

        /**
         * Handles email/password login.
         */
        async function signInWithEmailPassword() {
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value;
            console.log(`Attempting email login for: ${email}`);
            if (!email || !password) {
                showAuthError("Please enter both email and password.");
                return;
            }
            try {
                await signInWithEmailAndPassword(auth, email, password);
                console.log("Signed in with email/password successfully.");
            } catch (error) {
                console.error("Error signing in with email/password:", error);
                showAuthError(`Login failed: ${error.message}`);
            }
        }

        /**
         * Handles sending a password reset email.
         */
        async function handleForgotPassword() {
            const email = loginEmailInput.value.trim(); 
            console.log(`Attempting to send password reset email to: ${email}`);
            if (!email) {
                showAuthError("Please enter your email address to reset your password.");
                return;
            }
            try {
                await sendPasswordResetEmail(auth, email);
                authErrorMessage.textContent = "Password reset email sent! Please check your inbox (and spam folder).";
                authErrorMessage.style.color = '#059669'; 
                authErrorMessage.style.display = 'block';
                console.log("Password reset email sent successfully.");
            } catch (error) {
                console.error("Error sending password reset email:", error);
                showAuthError(`Failed to send password reset email: ${error.message}`);
            }
        }

        /**
         * Handles user logout.
         */
        async function logoutUser() {
            console.log("Attempting to log out user...");
            try {
                await signOut(auth);
                console.log("User signed out successfully.");
            } catch (error) {
                console.error("Error signing out:", error);
                showAuthError(`Logout failed: ${error.message}`);
            }
        }

        /**
         * Hides all main content containers.
         */
        function hideAllContainers() {
            authContainer.style.display = 'none';
            homeScreenContainer.style.display = 'none';
            subjectSelectionContainer.style.display = 'none';
            gaSubjectsContainer.style.display = 'none';
            reasoningSubjectsContainer.style.display = 'none';
            quantitativeAptitudeSubjectsContainer.style.display = 'none';
            englishLanguageSubjectsContainer.style.display = 'none';
            computerKnowledgeSubjectsContainer.style.display = 'none';
            generalStudiesSubjectsContainer.style.display = 'none';
            currentAffairsSubjectsContainer.style.display = 'none';
            mockTestZoneSubjectsContainer.style.display = 'none';
            questionCountContainer.style.display = 'none';
            quizContainer.style.display = 'none';
            userDataContainer.style.display = 'none';
            userProfileContainer.style.display = 'none';
            resultSummaryContainer.style.display = 'none';
            solutionExplanationContainer.style.display = 'none';
            settingsContainer.style.display = 'none';
            extraFeaturesContainer.style.display = 'none';
            splashScreen.style.display = 'none';
        }

        /**
         * Initializes the quiz by displaying the splash screen first.
         * After a delay, it transitions to the appropriate UI based on auth state.
         */
        async function initQuiz() { 
            console.log("initQuiz called.");
            hideAllContainers(); // Hide all containers
            splashScreen.style.display = 'flex'; // Show splash screen initially
            splashScreen.classList.remove('hidden'); // Ensure it's not hidden from previous runs

            // Fetch questions from DB in the background while splash screen is active
            await fetchAllQuestionsFromDB();

            // After a short delay, hide splash screen and proceed to main UI
            setTimeout(() => {
                console.log("Splash screen timer finished. Transitioning to main UI.");
                // Force UI update based on current auth state
                updateUI(auth.currentUser);
            }, 1000); // Changed from 2000 to 1000 for 1 second splash screen
        }


        /**
         * Prepares the quiz by filtering and shuffling questions, then shows the question count selection.
         * @param {string} subject - The selected subject (e.g., "Economy", "Politics", "History", "Geography", "Static GK", "Algebra", etc.).
         * @param {string} originScreenId - The ID of the screen that triggered this function (e.g., 'ga-subjects-container').
         */
        function prepareQuiz(subject, originScreenId) {
            console.log(`Preparing quiz for subject: ${subject} from ${originScreenId}`);
            selectedSubjectName = subject; 
            lastQuizSetupScreen = originScreenId; // Store the origin screen ID
            
            let subjectQuestions = [];

            // Special handling for "Full Mock Test" or "Mock Test Zone" if it combines all questions
            if (subject === "Full Length Mocks") { // Assuming "Full Length Mocks" is the combined one
                Object.values(allQuestionsFromDB).forEach(qArray => {
                    subjectQuestions = subjectQuestions.concat(qArray);
                });
                console.log(`Full Length Mocks: Combined ${subjectQuestions.length} questions from all subjects.`);
            } else if (allQuestionsFromDB[subject]) {
                subjectQuestions = [...allQuestionsFromDB[subject]];
            } else {
                console.warn(`No questions available for subject: ${subject}. This might be a missing subject in your database.`);
            }

            if (!subjectQuestions || subjectQuestions.length === 0) {
                console.warn(`No questions available for subject: ${subject}`);
                questionCountError.textContent = `No questions found for ${subject}. This section is coming soon!`;
                questionCountError.style.display = 'block';
                startPracticeButton.disabled = true; 
                
                hideAllContainers(); // Hide all containers
                questionCountContainer.style.display = 'flex'; 

                selectedSubjectTitle.textContent = subject;
                totalAvailableQuestionsSpan.textContent = 0; 
                numQuestionsInput.value = 0;
                numQuestionsInput.max = 0;
                return; 
            }

            questions = shuffleArray([...subjectQuestions]); 

            hideAllContainers(); // Hide all containers
            questionCountContainer.style.display = 'flex';

            selectedSubjectTitle.textContent = subject;
            totalAvailableQuestionsSpan.textContent = questions.length;
            numQuestionsInput.value = Math.min(10, questions.length); 
            numQuestionsInput.max = questions.length; 
            questionCountError.style.display = 'none'; 
            startPracticeButton.disabled = false; 
            console.log(`Total questions available for ${subject}: ${questions.length}`);
        }

        /**
         * Starts the actual quiz after the user has selected the number of questions.
         */
        function startActualQuiz() {
            const desiredCount = parseInt(numQuestionsInput.value, 10);
            const totalAvailable = questions.length;

            if (isNaN(desiredCount) || desiredCount <= 0 || desiredCount > totalAvailable) {
                questionCountError.textContent = `Please enter a number between 1 and ${totalAvailable}.`;
                questionCountError.style.display = 'block';
                return;
            }

            // Slice the questions array to the desired count
            questions = questions.slice(0, desiredCount);
            quizQuestionsAttempted = [...questions]; 
            console.log(`Starting quiz with ${questions.length} questions.`);

            // Reset quiz stats
            currentQuestionIndex = 0;
            correctAnswersCount = 0;
            incorrectAnswersCount = 0;
            questionsAttempted = 0;
            totalTimeTaken = 0;

            // Update quiz title based on selected subject
            quizSubjectTitle.textContent = `${selectedSubjectName} Practice - Set 1`;
            
            hideAllContainers(); // Hide all containers
            quizContainer.style.display = 'flex';

            displayQuestion();
        }

        /**
         * Displays the current question and its options, and starts the countdown timer.
         */
        function displayQuestion() {
            console.log(`Displaying question ${currentQuestionIndex + 1}/${questions.length}`);
            // Clear previous feedback and options
            optionsContainer.innerHTML = '';
            feedbackArea.textContent = '';
            correctAnswerArea.textContent = '';
            nextButton.disabled = true; 

            if (currentQuestionIndex < questions.length) {
                const questionData = questions[currentQuestionIndex];
                questionDisplay.textContent = `${currentQuestionIndex + 1}. ${questionData.question}`;
                timerDisplay.textContent = timePerQuestion; 
                questionStartTime = new Date().getTime(); 

                // Randomize the order of options for the current question
                const shuffledOptions = shuffleArray([...questionData.options]); 

                // Create option buttons
                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('option-button');
                    button.addEventListener('click', () => answerQuestion(option, questionData.answer, button));
                    optionsContainer.appendChild(button);
                });

                startCountdown();
            } else {
                // Quiz finished (all questions attempted naturally)
                console.log("All questions answered, ending quiz naturally.");
                endQuiz();
            }
        }

        /**
         * Starts the 20-second countdown for the current question.
         */
        function startCountdown() {
            let timeLeft = timePerQuestion;
            timerDisplay.textContent = timeLeft;
            console.log(`Timer started for question ${currentQuestionIndex + 1}, time left: ${timeLeft}`);

            // Clear any existing interval to prevent multiple timers running
            if (timerInterval) {
                clearInterval(timerInterval);
                console.log("Previous timer cleared.");
            }

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's Up!";
                    console.log("Time's Up for current question.");

                    // If the user hasn't selected an answer when time runs out,
                    // mark it as incorrect and attempted.
                    if (nextButton.disabled) {
                        questionsAttempted++;
                        incorrectAnswersCount++;
                        console.log("Time ran out, no answer selected. Marked as incorrect.");
                    }
                    const currentQuestion = questions[currentQuestionIndex];
                    const timeElapsed = Math.floor((new Date().getTime() - questionStartTime) / 1000);
                    totalTimeTaken += timeElapsed; 

                    showAnswer(currentQuestion.answer, null); 
                    disableOptions(); 
                    nextButton.disabled = false; 
                    console.log("Next button enabled (time out).");
                }
            }, 1000); 
        }

        /**
         * Handles the user's answer selection.
         * @param {string} selectedOption - The option selected by the user.
         * @param {string} correctAnswer - The correct answer for the current question.
         * @param {HTMLButtonElement} selectedButton - The button element that was clicked.
         */
        function answerQuestion(selectedOption, correctAnswer, selectedButton) {
            console.log(`Answer selected: ${selectedOption}`);
            clearInterval(timerInterval); 
            disableOptions(); 

            questionsAttempted++;
            const timeElapsed = Math.floor((new Date().getTime() - questionStartTime) / 1000);
            totalTimeTaken += timeElapsed;
            console.log(`Time taken for question: ${timeElapsed}s`);


            if (selectedOption === correctAnswer) {
                feedbackArea.textContent = "✅ Correct!";
                feedbackArea.style.color = '#059669'; 
                if (selectedButton) {
                    selectedButton.classList.add('correct');
                }
                correctAnswersCount++;
                console.log("Answer: Correct!");
            } else {
                feedbackArea.textContent = "❌ Incorrect.";
                feedbackArea.style.color = '#ef4444'; 
                if (selectedButton) {
                    selectedButton.classList.add('incorrect');
                }
                incorrectAnswersCount++;
                console.log("Answer: Incorrect!");
            }
            showAnswer(correctAnswer, selectedButton);
            nextButton.disabled = false; 
            console.log("Next button enabled (answer selected).");
        }

        /**
         * Displays the correct answer and highlights the correct option.
         * @param {string} correctAnswer - The correct answer to display.
         * @param {HTMLButtonElement | null} selectedButton - The button selected by the user, or null if time ran out.
         */
        function showAnswer(correctAnswer, selectedButton) {
            correctAnswerArea.textContent = `Correct Answer: ${correctAnswer}`;
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            optionButtons.forEach(button => {
                if (button.textContent === correctAnswer) {
                    // Only add 'correct' class if it wasn't already marked 'incorrect' by the user
                    if (!button.classList.contains('incorrect')) {
                        button.classList.add('correct');
                    }
                }
            });
        }

        /**
         * Disables all option buttons to prevent further selection.
         */
        function disableOptions() {
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            optionButtons.forEach(button => {
                button.disabled = true;
            });
        }

        /**
         * Ends the quiz and displays the summary statistics.
         * Also attempts to save the quiz results to Realtime Database and update streak.
         */
        async function endQuiz() {
            console.log("Ending quiz and showing summary.");
            clearInterval(timerInterval); 
            hideAllContainers(); // Hide all containers
            resultSummaryContainer.style.display = 'flex';

            // Calculate score percentage
            const scorePercentage = questionsAttempted > 0 ? ((correctAnswersCount / questionsAttempted) * 100).toFixed(2) : 0;

            // Populate result summary details
            resultSubject.textContent = selectedSubjectName;
            resultTotalQuestions.textContent = questionsAttempted;
            resultCorrectCount.textContent = correctAnswersCount;
            resultIncorrectCount.textContent = incorrectAnswersCount;
            resultTimeTaken.textContent = totalTimeTaken;
            resultScorePercentage.textContent = `${scorePercentage}%`;

            // Save quiz results to Realtime Database and update streak if a user is logged in
            if (auth.currentUser && auth.currentUser.uid) {
                const currentUserId = auth.currentUser.uid;
                const userRef = ref(db, `users/${currentUserId}`);
                const quizAttemptsRef = ref(db, `users/${currentUserId}/quizAttempts`);

                try {
                    await push(quizAttemptsRef, {
                        subject: selectedSubjectName,
                        score: correctAnswersCount,
                        totalQuestions: questionsAttempted,
                        accuracy: parseFloat(scorePercentage), 
                        timeTaken: totalTimeTaken,
                        timestamp: serverTimestamp() 
                    });
                    console.log("Quiz results saved to Realtime Database successfully!");

                    // 2. Update daily streak
                    const snapshot = await get(userRef);
                    let currentStreak = 0;
                    let lastQuizDate = null;

                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        currentStreak = userData.currentStreak || 0;
                        lastQuizDate = userData.lastQuizDate ? new Date(userData.lastQuizDate) : null; 
                    }

                    const today = new Date();
                    today.setHours(0, 0, 0, 0); 

                    if (lastQuizDate) {
                        const lastQuizDay = new Date(lastQuizDate);
                        lastQuizDay.setHours(0, 0, 0, 0);

                        const yesterday = new Date(today);
                        yesterday.setDate(today.getDate() - 1);

                        if (lastQuizDay.getTime() === today.getTime()) {
                            console.log("Already played today, streak continues.");
                        } else if (lastQuizDay.getTime() === yesterday.getTime()) {
                            currentStreak++;
                            console.log("Played yesterday, streak incremented to:", currentStreak);
                        } else {
                            currentStreak = 1;
                            console.log("Streak broken, reset to 1.");
                        }
                    } else {
                        currentStreak = 1;
                        console.log("First quiz, streak started at 1.");
                    }

                    // Use update() to only modify the streak and lastQuizDate fields
                    await update(userRef, {
                        currentStreak: currentStreak,
                        lastQuizDate: serverTimestamp() 
                    }); 
                    console.log("Daily streak updated successfully in Realtime Database!");

                } catch (error) {
                    console.error("Error saving quiz results or updating streak to Realtime Database:", error);
                }
            } else {
                console.log("No authenticated user found, skipping saving quiz results and streak update to Realtime Database.");
            }
        }

        /**
         * Displays the solutions and explanations for the questions in the quiz.
         */
        function displaySolutions() {
            console.log("Displaying solutions.");
            hideAllContainers(); // Hide all containers
            solutionExplanationContainer.style.display = 'flex';
            solutionsList.innerHTML = ''; 

            if (quizQuestionsAttempted.length === 0) {
                solutionsList.innerHTML = '<p class="text-gray-600">No questions were attempted in the last quiz.</p>';
                return;
            }

            quizQuestionsAttempted.forEach((qData, index) => {
                const solutionItem = document.createElement('div');
                solutionItem.classList.add('solution-item', 'bg-gray-50', 'p-4', 'rounded-lg', 'mb-4', 'text-left', 'border', 'border-gray-200');

                const questionP = document.createElement('p');
                questionP.classList.add('font-bold', 'text-lg', 'mb-2');
                questionP.innerHTML = `Question ${index + 1}: <span class="solution-q-text">${qData.question}</span>`;
                solutionItem.appendChild(questionP);

                const answerP = document.createElement('p');
                answerP.classList.add('mb-2');
                answerP.innerHTML = `Correct Answer: <span class="solution-a-text text-green-600 font-semibold">${qData.answer}</span>`;
                solutionItem.appendChild(answerP);

                const explanationP = document.createElement('p');
                explanationP.classList.add('text-gray-700', 'mb-2');
                explanationP.innerHTML = `Detailed Explanation: <span class="solution-exp-text">${qData.explanation || 'Explanation not available for this question. (Add `explanation` field to your question data in Firebase.)'}</span>`;
                solutionItem.appendChild(explanationP);

                if (qData.learnMoreUrl) {
                    const learnMoreLink = document.createElement('a');
                    learnMoreLink.href = qData.learnMoreUrl;
                    learnMoreLink.textContent = 'Learn More';
                    learnMoreLink.classList.add('solution-learn-more', 'text-blue-600', 'hover:underline', 'block', 'mt-2');
                    learnMoreLink.target = '_blank';
                    solutionItem.appendChild(learnMoreLink);
                } else {
                    const noLearnMore = document.createElement('p');
                    noLearnMore.classList.add('text-gray-500', 'text-sm', 'mt-1');
                    noLearnMore.textContent = 'No "Learn More" link available. (Add `learnMoreUrl` field to your question data in Firebase.)';
                    solutionItem.appendChild(noLearnMore);
                }

                solutionsList.appendChild(solutionItem);
            });
        }

        /**
         * Fetches and displays the user's past quiz attempts and current streak from Realtime Database.
         */
        async function displayUserData() {
            console.log("displayUserData called.");
            if (!auth.currentUser || !auth.currentUser.uid) {
                console.log("No user logged in to display data.");
                showAuthError("Please log in to view your activity.");
                return;
            }

            hideAllContainers(); // Hide all containers
            userDataContainer.style.display = 'flex';

            pastAttemptsList.innerHTML = '<p class="text-gray-600">Loading your past quiz attempts...</p>'; 

            const currentUserId = auth.currentUser.uid;
            const userRef = ref(db, `users/${currentUserId}`);
            const quizAttemptsRef = ref(db, `users/${currentUserId}/quizAttempts`);

            try {
                // Fetch current streak
                const userSnapshot = await get(userRef);
                if (userSnapshot.exists()) {
                    const userData = userSnapshot.val();
                    currentStreakDisplay.textContent = userData.currentStreak || 0;
                } else {
                    currentStreakDisplay.textContent = 0;
                }

                // Fetch past quiz attempts, limited to the last 20 for performance
                const attemptsQuery = query(quizAttemptsRef, orderByChild('timestamp'), limitToLast(20));
                const attemptsSnapshot = await get(attemptsQuery);

                if (!attemptsSnapshot.exists() || Object.keys(attemptsSnapshot.val()).length === 0) {
                    pastAttemptsList.innerHTML = '<p class="text-gray-600">No past quiz attempts found.</p>';
                } else {
                    const attemptsData = attemptsSnapshot.val();
                    const attemptsArray = Object.keys(attemptsData).map(key => ({
                        id: key,
                        ...attemptsData[key]
                    }));

                    // Sort attempts by timestamp in descending order (most recent first)
                    attemptsArray.sort((a, b) => b.timestamp - a.timestamp);

                    let tableHtml = `
                        <table class="user-data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Subject</th>
                                    <th>Score</th>
                                    <th>Total Qs</th>
                                    <th>Accuracy</th>
                                    <th>Time Taken</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    attemptsArray.forEach((data) => {
                        const date = formatTimestamp(data.timestamp);
                        const accuracy = typeof data.accuracy === 'number' ? `${data.accuracy}%` : 'N/A';
                        tableHtml += `
                            <tr>
                                <td>${date}</td>
                                <td>${data.subject || 'N/A'}</td>
                                <td>${data.score || 0}</td>
                                <td>${data.totalQuestions || 0}</td>
                                <td>${accuracy}</td>
                                <td>${data.timeTaken || 0}s</td>
                            </tr>
                        `;
                    });
                    tableHtml += `</tbody></table>`;
                    pastAttemptsList.innerHTML = tableHtml;
                }
            } catch (error) {
                console.error("Error fetching user data from Realtime Database:", error);
                pastAttemptsList.innerHTML = '<p class="text-red-500">Error loading data. Please try again.</p>';
            }
        }

        /**
         * Fetches and displays the user's profile data, populating editable fields and progress stats.
         */
        async function displayUserProfile() {
            console.log("displayUserProfile called.");
            if (!auth.currentUser || !auth.currentUser.uid) {
                console.log("No user logged in to display profile.");
                showAuthError("Please log in to view your profile.");
                return;
            }

            hideAllContainers(); // Hide all containers
            userProfileContainer.style.display = 'flex';
            profileMessage.style.display = 'none'; 

            userIdDisplayProfile.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';

            const currentUserId = auth.currentUser.uid;
            const userRef = ref(db, `users/${currentUserId}`);
            const quizAttemptsRef = ref(db, `users/${currentUserId}/quizAttempts`);

            try {
                const snapshot = await get(userRef);
                let userData = {};
                if (snapshot.exists()) {
                    userData = snapshot.val();
                }

                // Populate editable input fields
                editDisplayNameInput.value = userData.displayName || auth.currentUser.displayName || '';
                editEmailInput.value = userData.email || auth.currentUser.email || '';
                editMobileInput.value = userData.mobile || ''; 
                editAgeInput.value = userData.age || ''; 
                editGenderInput.value = userData.gender || ''; 
                editAboutYouInput.value = userData.aboutYou || ''; 
                profileUserId.textContent = currentUserId;
                profilePhoto.src = userData.photoURL || auth.currentUser.photoURL || "https://placehold.co/120x120/cccccc/333333?text=👤";

                // Calculate and display Progress Stats
                const attemptsSnapshot = await get(quizAttemptsRef);
                let totalAttempts = 0;
                let totalCorrectQuestions = 0;
                let totalQuestionsAcrossAttempts = 0;
                const subjectScores = {}; 

                if (attemptsSnapshot.exists()) {
                    const attemptsData = attemptsSnapshot.val();
                    Object.values(attemptsData).forEach(attempt => {
                        totalAttempts++;
                        totalCorrectQuestions += (attempt.score || 0);
                        totalQuestionsAcrossAttempts += (attempt.totalQuestions || 0);

                        const subject = attempt.subject || 'Unknown';
                        if (!subjectScores[subject]) {
                            subjectScores[subject] = { totalCorrect: 0, totalQuestions: 0 };
                        }
                        subjectScores[subject].totalCorrect += (attempt.score || 0);
                        subjectScores[subject].totalQuestions += (attempt.totalQuestions || 0);
                    });
                }

                profileTestsAttempted.textContent = totalAttempts;
                const overallAverageScore = totalQuestionsAcrossAttempts > 0 ? 
                                            ((totalCorrectQuestions / totalQuestionsAcrossAttempts) * 100).toFixed(2) : 0;
                profileAverageScore.textContent = `${overallAverageScore}%`;

                // Determine Weak Areas
                profileWeakAreas.innerHTML = ''; 
                let weakAreasFound = false;
                const WEAK_AREA_THRESHOLD = 60; 

                for (const subject in subjectScores) {
                    const data = subjectScores[subject];
                    if (data.totalQuestions > 0) {
                        const avgScore = (data.totalCorrect / data.totalQuestions) * 100;
                        if (avgScore < WEAK_AREA_THRESHOLD) {
                            const listItem = document.createElement('li');
                            listItem.textContent = `${subject} (${avgScore.toFixed(2)}%)`;
                            profileWeakAreas.appendChild(listItem);
                            weakAreasFound = true;
                        }
                    }
                }

                if (!weakAreasFound) {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'No weak areas identified yet! Keep practicing!';
                    profileWeakAreas.appendChild(listItem);
                }


            } catch (error) {
                console.error("Error fetching user profile data or quiz attempts:", error);
                profileMessage.textContent = 'Error loading profile data. Please try again.';
                profileMessage.style.color = '#ef4444';
                profileMessage.style.display = 'block';
                // Fallback to auth data for display if DB fetch fails
                editDisplayNameInput.value = auth.currentUser.displayName || '';
                editEmailInput.value = auth.currentUser.email || '';
                editMobileInput.value = ''; 
                editAgeInput.value = ''; 
                editGenderInput.value = ''; 
                editAboutYouInput.value = ''; 
                profileUserId.textContent = currentUserId;
                profilePhoto.src = auth.currentUser.photoURL || "https://placehold.co/120x120/cccccc/333333?text=�";
                profileTestsAttempted.textContent = 'N/A';
                profileAverageScore.textContent = 'N/A';
                profileWeakAreas.innerHTML = '<li>Error loading weak areas.</li>';
            }
        }

        /**
         * Saves the user's profile data from the editable fields to Realtime Database.
         */
        async function saveUserProfile() {
            console.log("Attempting to save user profile...");
            if (!auth.currentUser || !auth.currentUser.uid) {
                profileMessage.textContent = "Please log in to save your profile.";
                profileMessage.style.color = '#ef4444';
                profileMessage.style.display = 'block';
                return;
            }

            const currentUserId = auth.currentUser.uid;
            const userRef = ref(db, `users/${currentUserId}`);
            const newDisplayName = editDisplayNameInput.value.trim();
            const newEmail = editEmailInput.value.trim();
            const newMobile = editMobileInput.value.trim(); 
            const newAge = editAgeInput.value.trim(); 
            const newGender = editGenderInput.value.trim(); 
            const newAboutYou = editAboutYouInput.value.trim(); 

            const updates = {};
            // Fetch current data from DB to compare and only update changed fields
            let currentDbData = {};
            try {
                const snapshot = await get(userRef);
                if (snapshot.exists()) {
                    currentDbData = snapshot.val();
                }
            } catch (error) {
                console.error("Error fetching current user data for comparison:", error);
                // Continue with updates based on UI values if DB fetch fails for comparison
            }

            if (newDisplayName !== (currentDbData.displayName || auth.currentUser.displayName || '')) {
                updates.displayName = newDisplayName;
            }
            // Note: This updates email in RTDB, not Firebase Auth primary email.
            if (newEmail !== (currentDbData.email || auth.currentUser.email || '')) {
                updates.email = newEmail;
            }
            if (newMobile !== (currentDbData.mobile || '')) {
                updates.mobile = newMobile;
            }
            if (newAge !== (currentDbData.age || '')) {
                updates.age = newAge;
            }
            if (newGender !== (currentDbData.gender || '')) {
                updates.gender = newGender;
            }
            if (newAboutYou !== (currentDbData.aboutYou || '')) {
                updates.aboutYou = newAboutYou;
            }

            if (Object.keys(updates).length === 0) {
                profileMessage.textContent = "No changes to save.";
                profileMessage.style.color = '#4a5568';
                profileMessage.style.display = 'block';
                return;
            }

            try {
                // Update profile in Realtime Database
                await update(userRef, updates);

                // Optionally, update Firebase Authentication profile (only display name is easily updatable this way)
                if (updates.displayName && auth.currentUser) {
                    await updateProfile(auth.currentUser, { displayName: newDisplayName });
                    // Re-fetch user data to update UI with latest auth display name
                    updateUI(auth.currentUser); 
                }

                profileMessage.textContent = "Profile saved successfully!";
                profileMessage.style.color = '#059669';
                profileMessage.style.display = 'block';
                console.log("User profile saved to DB and Auth (if display name changed).");

            } catch (error) {
                console.error("Error saving user profile:", error);
                profileMessage.textContent = `Failed to save profile: ${error.message}`;
                profileMessage.style.color = '#ef4444';
                profileMessage.style.display = 'block';
            }
        }

        /**
         * Displays the settings page.
         */
        function displaySettings() {
            console.log("displaySettings called.");
            hideAllContainers(); // Hide all containers
            settingsContainer.style.display = 'flex';
            userIdDisplaySettings.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
        }

        /**
         * Displays the extra features page.
         */
        function displayExtraFeatures() {
            console.log("displayExtraFeatures called.");
            hideAllContainers(); // Hide all containers
            extraFeaturesContainer.style.display = 'flex';
            userIdDisplayExtraFeatures.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
        }


        /**
         * Moves to the next question or ends the quiz if all questions are answered.
         */
        nextButton.addEventListener('click', () => {
            console.log("Next button clicked. Moving to next question.");
            currentQuestionIndex++;
            displayQuestion();
        });

        // Event listeners for subject selection buttons (old, now mostly unused)
        economyButton.addEventListener('click', () => prepareQuiz("Economy", 'subject-selection-container'));
        politicsButton.addEventListener('click', () => prepareQuiz("Politics", 'subject-selection-container'));
        historyButton.addEventListener('click', () => prepareQuiz("History", 'subject-selection-container'));
        geographyButton.addEventListener('click', () => prepareQuiz("Geography", 'subject-selection-container'));

        // Event listener for the "Start Practice" button
        startPracticeButton.addEventListener('click', startActualQuiz);

        // Event listener for the new "Show Result" button
        showResultButton.addEventListener('click', endQuiz);

        // Event listener for the "View My Activity" button
        viewActivityButton.addEventListener('click', displayUserData);

        // Event listener for the "View My Profile" button
        viewProfileButton.addEventListener('click', displayUserProfile); 

        // Event listener for the "Save Profile" button
        saveProfileButton.addEventListener('click', saveUserProfile);

        // Event listener for the "Go to Settings" button
        goToSettingsButton.addEventListener('click', displaySettings);

        // Event listener for the "Extra Features" button
        extraFeaturesButton.addEventListener('click', displayExtraFeatures);

        // Event listener for the "Back to Quiz Selection" button (from Activity)
        backToQuizSelectionButton.addEventListener('click', initQuiz); 

        // Event listener for the "Back to Quiz Selection" button (from Profile)
        backToSubjectSelectionFromProfileButton.addEventListener('click', initQuiz); 

        // Event listener for "Back to Profile" button (from Settings)
        backToProfileFromSettingsButton.addEventListener('click', displayUserProfile);

        // Event listener for "Back to Home" button (from Extra Features)
        backToHomeFromExtraFeaturesButton.addEventListener('click', initQuiz);

        // Event listeners for Result Summary Page buttons
        retryTestButton.addEventListener('click', () => {
            console.log("Retry Test button clicked. Navigating to home screen.");
            initQuiz(); // Go back to the home screen
        });
        viewSolutionsButton.addEventListener('click', () => {
            displaySolutions(); // Call the new function to show solutions
        });
        shareScoreButton.addEventListener('click', () => {
            // Placeholder for sharing score
            const score = resultScorePercentage.textContent;
            const subject = resultSubject.textContent;
            const message = `I scored ${score} in the ${subject} quiz on SSC Prep App! Can you beat me? #SSCPrep #Quiz`;
            // For web, you might use Web Share API or copy to clipboard
            if (navigator.share) {
                navigator.share({
                    title: 'My Quiz Score',
                    text: message,
                }).then(() => console.log('Share successful'))
                .catch((error) => console.error('Error sharing', error));
            } else {
                // Fallback for browsers that don't support Web Share API
                document.execCommand('copy');
                console.log(`Score copied to clipboard! Share this:\n"${message}"`); // Replaced alert
            }
        });

        // New event listener for "Back to Results" button on Solution/Explanation page
        backToResultsButton.addEventListener('click', () => {
            console.log("Back to Results button clicked.");
            hideAllContainers();
            resultSummaryContainer.style.display = 'flex'; // Show the result summary again
        });

        // Placeholder for settings page actions (can be expanded later)
        changePasswordButton.addEventListener('click', () => console.log('Change Password functionality coming soon!')); // Replaced alert
        notificationsToggle.addEventListener('change', (event) => console.log('Notifications toggled:', event.target.checked));
        languageSelect.addEventListener('change', (event) => console.log('Language changed to:', event.target.value));
        darkModeToggle.addEventListener('change', (event) => {
            if (event.target.checked) {
                document.body.style.backgroundColor = '#1a202c'; // Dark background
                document.querySelectorAll('.quiz-container, .subject-selection-container, .question-count-container, .user-data-container, .user-profile-container, .result-summary-container, .solution-explanation-container, .settings-container, .extra-features-container, .ga-subjects-container, .reasoning-subjects-container, .quantitative-aptitude-subjects-container, .english-language-subjects-container, .computer-knowledge-subjects-container, .general-studies-subjects-container, .current-affairs-subjects-container, .mock-test-zone-subjects-container').forEach(el => {
                    el.style.backgroundColor = 'rgba(45, 55, 72, 0.9)'; // Darker card background with transparency
                    el.style.color = '#e2e8f0'; // Light text
                });
                document.querySelectorAll('.question-text, h1, h2, p, label').forEach(el => {
                    el.style.color = '#e2e8f0'; // Light text for other elements
                });
                document.querySelectorAll('.option-button, .subject-button, .start-practice-button, .view-activity-button, .back-button, .view-profile-button, .settings-button, .extra-feature-button').forEach(el => {
                    el.style.backgroundColor = '#4a5568'; // Darker button background
                    el.style.color = '#e2e8f0'; // Light button text
                    el.style.borderColor = '#6b7280'; // Darker border
                });
                document.querySelectorAll('.auth-input, .profile-input, .settings-input').forEach(el => {
                    el.style.backgroundColor = '#2d3748';
                    el.style.color = '#e2e8f0';
                    el.style.borderColor = '#6b7280';
                });
                document.querySelectorAll('.user-info-container p, .user-info-container span').forEach(el => {
                    el.style.color = '#a0aec0'; // Lighter grey for user info
                });
                document.querySelectorAll('.quick-access-card').forEach(el => {
                    el.style.backgroundColor = '#4a5568';
                    el.style.color = '#e2e8f0';
                    el.style.borderColor = '#6b7280';
                });
                document.querySelectorAll('.profile-stat-card').forEach(el => {
                    el.style.backgroundColor = '#4a5568';
                    el.style.color = '#e2e8f0';
                    el.style.borderColor = '#6b7280';
                });
                document.querySelectorAll('.user-data-table th').forEach(el => {
                    el.style.backgroundColor = '#4a5568';
                    el.style.color = '#e2e8f0';
                });
                document.querySelectorAll('.user-data-table tbody tr').forEach(el => {
                    el.style.backgroundColor = '#2d3748';
                    el.style.color = '#e2e8f0';
                });
                document.querySelectorAll('.user-data-table tbody tr:nth-child(even)').forEach(el => {
                    el.style.backgroundColor = '#4a5568';
                });
                document.querySelectorAll('.user-data-table tbody tr:hover').forEach(el => {
                    el.style.backgroundColor = '#6b7280';
                });
                document.querySelectorAll('.profile-intro-text').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.profile-intro-text h2').forEach(el => {
                    el.style.color = '#e2e8f0';
                });
                document.querySelectorAll('.profile-intro-text p').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.profile-intro-text ul').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.profile-intro-text li').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.feedback-message').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.correct-answer-display').forEach(el => {
                    el.style.color = '#68d391'; 
                });
                document.querySelectorAll('.timer-display').forEach(el => {
                    el.style.color = '#f87171'; 
                });
                document.querySelectorAll('.quiz-finished-message').forEach(el => {
                    el.style.color = '#68d391';
                });
                document.querySelectorAll('.quiz-summary p').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.quiz-summary p span').forEach(el => {
                    el.style.color = '#e2e8f0';
                });
                document.querySelectorAll('.score-percentage').forEach(el => {
                    el.style.color = '#818cf8'; 
                });
                document.querySelectorAll('.solution-item').forEach(el => {
                    el.style.backgroundColor = 'rgba(45, 55, 72, 0.9)';
                    el.style.borderColor = '#4a5568';
                });
                document.querySelectorAll('.solution-item .solution-q-text').forEach(el => {
                    el.style.color = '#e2e8f0';
                });
                document.querySelectorAll('.solution-item .solution-a-text').forEach(el => {
                    el.style.color = '#68d391';
                });
                document.querySelectorAll('.solution-item .solution-exp-text').forEach(el => {
                    el.style.color = '#a0aec0';
                });
                document.querySelectorAll('.solution-item .solution-learn-more').forEach(el => {
                    el.style.color = '#818cf8';
                });
                document.querySelectorAll('.solution-item .noLearnMore').forEach(el => {
                    el.style.color = '';
                });
                document.querySelectorAll('.profile-message').forEach(el => {
                    el.style.color = '';
                });
                document.querySelectorAll('.weak-areas-list').forEach(el => {
                    el.style.color = '';
                });
                document.querySelectorAll('.feature-item').forEach(el => {
                    el.style.backgroundColor = '';
                    el.style.borderColor = '';
                    el.style.color = '';
                });
                document.querySelectorAll('.feature-item .icon').forEach(el => {
                    el.style.color = '';
                });
            }
        });
        helpFeedbackButton.addEventListener('click', () => console.log('Help and Feedback functionality coming soon!')); // Replaced alert


        // Attach event listeners after the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Content Loaded. Attaching primary event listeners.");

            // Initialize Firebase app, auth, and db here
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getDatabase(app);

            // Firebase Auth State Listener - moved here to ensure 'auth' is defined
            onAuthStateChanged(auth, async (user) => {
                console.log("onAuthStateChanged fired. Current user:", user ? user.uid : "null");
                // If there's an initial token and no user is logged in yet, try to sign in with it
                if (typeof __initial_auth_token !== 'undefined' && user === null) {
                    try {
                        console.log("Attempting signInWithCustomToken...");
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with custom token successfully.");
                    } catch (error) {
                        console.error("Error signing in with custom token:", error);
                        // Fallback to anonymous if custom token fails
                        console.log("Falling back to anonymous sign-in...");
                        await signInAnonymously(auth);
                    }
                } else {
                    // User is already logged in or just logged in via custom token/anonymous
                    console.log("User state updated, calling updateUI.");
                    updateUI(user);
                }
            });

            // Call initQuiz to start the splash screen flow
            initQuiz(); 

            // Get references to elements that are guaranteed to be in the DOM now
            logoutButtons = document.querySelectorAll('.logout-button-class');
            console.log("Found logout buttons:", logoutButtons.length);

            // Attach event listeners for login/logout buttons
            anonymousLoginButton.addEventListener('click', loginAnonymously);
            googleLoginButton.addEventListener('click', signInWithGoogle);
            appleLoginButton.addEventListener('click', signInWithApple); // Apple login listener
            
            emailLoginButton.addEventListener('click', signInWithEmailPassword);
            forgotPasswordButton.addEventListener('click', handleForgotPassword); 
            emailSignupButton.addEventListener('click', signUpWithEmailPassword); 
            googleSignupButton.addEventListener('click', signInWithGoogle); // Google signup listener
            appleSignupButton.addEventListener('click', signInWithApple); // Apple signup listener

            showLoginButton.addEventListener('click', () => toggleAuthForms('login'));
            showSignupButton.addEventListener('click', () => toggleAuthForms('signup'));

            // Home Screen button listeners
            cardGeneralAwareness.addEventListener('click', () => {
                hideAllContainers();
                gaSubjectsContainer.style.display = 'flex'; // Show GA subjects container
                userIdDisplayGa.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User'; // Update user display
            });
            cardReasoning.addEventListener('click', () => {
                hideAllContainers();
                reasoningSubjectsContainer.style.display = 'flex';
                userIdDisplayReasoning.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardQuantitativeAptitude.addEventListener('click', () => {
                hideAllContainers();
                quantitativeAptitudeSubjectsContainer.style.display = 'flex';
                userIdDisplayQuant.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardEnglishLanguage.addEventListener('click', () => {
                hideAllContainers();
                englishLanguageSubjectsContainer.style.display = 'flex';
                userIdDisplayEnglish.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardComputerKnowledge.addEventListener('click', () => {
                hideAllContainers();
                computerKnowledgeSubjectsContainer.style.display = 'flex';
                userIdDisplayComputer.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardGeneralStudies.addEventListener('click', () => {
                hideAllContainers();
                generalStudiesSubjectsContainer.style.display = 'flex';
                userIdDisplayGeneralStudies.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardCurrentAffairs.addEventListener('click', () => {
                hideAllContainers();
                currentAffairsSubjectsContainer.style.display = 'flex';
                userIdDisplayCurrentAffairs.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            cardMockTestZone.addEventListener('click', () => {
                hideAllContainers();
                mockTestZoneSubjectsContainer.style.display = 'flex';
                userIdDisplayMockTestZone.textContent = auth.currentUser.email || auth.currentUser.displayName || 'Anonymous User';
            });
            extraFeaturesButton.addEventListener('click', displayExtraFeatures);

            // GA Sub-subject button listeners
            gaStaticGkButton.addEventListener('click', () => prepareQuiz("Static GK", 'ga-subjects-container'));
            gaCurrentAffairsButton.addEventListener('click', () => prepareQuiz("Current Affairs", 'ga-subjects-container'));
            gaPolityButton.addEventListener('click', () => prepareQuiz("Polity", 'ga-subjects-container'));
            gaHistoryButton.addEventListener('click', () => prepareQuiz("History", 'ga-subjects-container'));
            gaGeographyButton.addEventListener('click', () => prepareQuiz("Geography", 'ga-subjects-container'));
            gaScienceButton.addEventListener('click', () => prepareQuiz("Science", 'ga-subjects-container'));
            gaEconomyButton.addEventListener('click', () => prepareQuiz("Economy", 'ga-subjects-container'));
            backToHomeFromGaSubjectsButton.addEventListener('click', initQuiz); // Back to home

            // Reasoning Sub-subject button listeners
            reasoningAnalogyButton.addEventListener('click', () => prepareQuiz("Analogy", 'reasoning-subjects-container'));
            reasoningSeriesButton.addEventListener('click', () => prepareQuiz("Series", 'reasoning-subjects-container'));
            reasoningPuzzlesButton.addEventListener('click', () => prepareQuiz("Puzzles", 'reasoning-subjects-container'));
            reasoningCodingDecodingButton.addEventListener('click', () => prepareQuiz("Coding-Decoding", 'reasoning-subjects-container'));
            reasoningBloodRelationsButton.addEventListener('click', () => prepareQuiz("Blood Relations", 'reasoning-subjects-container'));
            backToHomeFromReasoningSubjectsButton.addEventListener('click', initQuiz);

            // Quantitative Aptitude Sub-subject button listeners
            quantArithmeticButton.addEventListener('click', () => prepareQuiz("Arithmetic", 'quantitative-aptitude-subjects-container'));
            quantAlgebraButton.addEventListener('click', () => prepareQuiz("Algebra", 'quantitative-aptitude-subjects-container'));
            quantGeometryButton.addEventListener('click', () => prepareQuiz("Geometry", 'quantitative-aptitude-subjects-container'));
            quantMensurationButton.addEventListener('click', () => prepareQuiz("Mensuration", 'quantitative-aptitude-subjects-container'));
            quantTrigonometryButton.addEventListener('click', () => prepareQuiz("Trigonometry", 'quantitative-aptitude-subjects-container'));
            quantDiButton.addEventListener('click', () => prepareQuiz("Data Interpretation", 'quantitative-aptitude-subjects-container'));
            backToHomeFromQuantSubjectsButton.addEventListener('click', initQuiz);

            // English Language Sub-subject button listeners
            englishVocabularyButton.addEventListener('click', () => prepareQuiz("Vocabulary", 'english-language-subjects-container'));
            englishGrammarButton.addEventListener('click', () => prepareQuiz("Grammar", 'english-language-subjects-container'));
            englishReadingComprehensionButton.addEventListener('click', () => prepareQuiz("Reading Comprehension", 'english-language-subjects-container'));
            englishClozeTestButton.addEventListener('click', () => prepareQuiz("Cloze Test", 'english-language-subjects-container'));
            englishSpotErrorButton.addEventListener('click', () => prepareQuiz("Spot the Error", 'english-language-subjects-container'));
            backToHomeFromEnglishSubjectsButton.addEventListener('click', initQuiz);

            // Computer Knowledge Sub-subject button listeners
            computerBasicsButton.addEventListener('click', () => prepareQuiz("Basics of Computer", 'computer-knowledge-subjects-container'));
            computerInternetButton.addEventListener('click', () => prepareQuiz("Internet", 'computer-knowledge-subjects-container'));
            computerMsOfficeButton.addEventListener('click', () => prepareQuiz("MS Office", 'computer-knowledge-subjects-container'));
            computerAbbreviationsButton.addEventListener('click', () => prepareQuiz("Abbreviations", 'computer-knowledge-subjects-container'));
            backToHomeFromComputerSubjectsButton.addEventListener('click', initQuiz);

            // General Studies Sub-subject button listeners
            gsEngineeringButton.addEventListener('click', () => prepareQuiz("Engineering Subjects", 'general-studies-subjects-container'));
            gsAdvancedEconomyButton.addEventListener('click', () => prepareQuiz("Advanced Economics", 'general-studies-subjects-container'));
            gsAdvancedPolityButton.addEventListener('click', () => prepareQuiz("Advanced Polity", 'general-studies-subjects-container'));
            backToHomeFromGeneralStudiesSubjectsButton.addEventListener('click', initQuiz);

            // Current Affairs Sub-subject button listeners
            caDailyQuizzesButton.addEventListener('click', () => prepareQuiz("Daily Quizzes", 'current-affairs-subjects-container'));
            caBudgetButton.addEventListener('click', () => prepareQuiz("Budget", 'current-affairs-subjects-container'));
            caGovtSchemesButton.addEventListener('click', () => prepareQuiz("Government Schemes", 'current-affairs-subjects-container'));
            caMonthlyPdfsButton.addEventListener('click', () => prepareQuiz("Monthly PDFs", 'current-affairs-subjects-container'));
            backToHomeFromCurrentAffairsSubjectsButton.addEventListener('click', initQuiz);

            // Mock Test Zone Sub-subject button listeners
            mtzFullLengthMocksButton.addEventListener('click', () => prepareQuiz("Full Length Mocks", 'mock-test-zone-subjects-container'));
            mtzSectionalTestsButton.addEventListener('click', () => prepareQuiz("Sectional Tests", 'mock-test-zone-subjects-container'));
            mtzTierWiseTestsButton.addEventListener('click', () => prepareQuiz("Tier-wise Tests", 'mock-test-zone-subjects-container'));
            backToHomeFromMockTestZoneSubjectsButton.addEventListener('click', initQuiz);


            // Event listener for the new home screen profile icon
            homeProfileIcon.addEventListener('click', displayUserProfile);

            logoutButtons.forEach((button, index) => {
                button.addEventListener('click', logoutUser);
                console.log(`Logout button ${index + 1} listener attached.`);
            });

            // New back button event listeners
            backToSubjectSelectionFromQuestionCountButton.addEventListener('click', () => {
                console.log(`Back from question count to: ${lastQuizSetupScreen}`);
                hideAllContainers();
                // Show the screen that led to question count
                if (lastQuizSetupScreen && document.getElementById(lastQuizSetupScreen)) {
                    document.getElementById(lastQuizSetupScreen).style.display = 'flex';
                } else {
                    // Fallback if lastQuizSetupScreen is not set or invalid
                    initQuiz(); // Go back to home screen
                }
            });

            backToQuestionCountFromQuizButton.addEventListener('click', () => {
                console.log("Back from quiz to question count.");
                clearInterval(timerInterval); // Stop timer if active
                hideAllContainers();
                questionCountContainer.style.display = 'flex';
                // Re-enable start practice button if it was disabled
                startPracticeButton.disabled = false;
                questionCountError.style.display = 'none'; // Clear any previous error
            });

            backToQuestionCountFromResultButton.addEventListener('click', () => {
                console.log("Back from result to question count.");
                hideAllContainers();
                questionCountContainer.style.display = 'flex';
                startPracticeButton.disabled = false;
                questionCountError.style.display = 'none';
            });
        });
    </script>
</body>
</html>
�
